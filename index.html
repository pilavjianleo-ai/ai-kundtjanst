<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Support AI</title>

  <link rel="stylesheet" href="style.css" />
</head>

<body data-theme="dark">
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">AI</div>
        <div>
          <div class="brandTitle">Support AI</div>
          <div class="brandSub">Intern dashboard</div>
        </div>
      </div>

      <div class="sidebarBlock">
        <div class="label">Navigation</div>
        <div class="menu">
          <button class="menuBtn active" id="btnChat" type="button">ğŸ’¬ Chat</button>

          <!-- âœ… Inbox med notif-dot (script kan toggla hasNotif + dot) -->
          <button class="menuBtn" id="btnInbox" type="button">
            ğŸ“¥ Inbox
            <span class="notifDot" id="inboxDot" style="display:none"></span>
          </button>

          <button class="menuBtn" id="btnTickets" type="button">ğŸ« Tickets</button>

          <!-- Admin (visas bara fÃ¶r admin i script.js) -->
          <button class="menuBtn" id="btnAdmin" type="button" style="display:none">ğŸ›  Admin</button>

          <!-- Auth / login view -->
          <button class="menuBtn" id="btnAuth" type="button" style="display:none">ğŸ” Konto</button>
        </div>
      </div>

      <div class="sidebarFooter">
        <button class="btn" id="btnTheme" type="button">ğŸŒ™ Tema</button>
        <button class="btn danger" id="btnLogout" type="button" style="display:none">Logga ut</button>

        <div class="debugPanel" id="debugPanel" style="display:none">
          <div><b>Debug</b></div>
          <div id="debugText">-</div>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="view">

        <!-- =========================
             AUTH VIEW
        ========================== -->
        <section class="card authCard" id="viewAuth" style="display:none">
          <h2>Logga in / Skapa konto</h2>
          <div class="muted small">Logga in som agent eller admin.</div>

          <div class="grid2">
            <div>
              <label for="authEmail">Email</label>
              <input class="input" id="authEmail" type="email" placeholder="namn@fÃ¶retag.se" />
            </div>
            <div>
              <label for="authPassword">LÃ¶senord</label>
              <input class="input" id="authPassword" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
            </div>
          </div>

          <div class="row gap" style="margin-top:12px">
            <button class="btn primary" id="btnLogin" type="button">Logga in</button>
            <button class="btn" id="btnRegister" type="button">Skapa konto</button>
            <button class="btn ghost" id="btnDevAdmin" type="button">Dev: Admin</button>
          </div>

          <div class="alert error" id="authError" style="display:none"></div>
        </section>

        <!-- =========================
             CHAT VIEW
        ========================== -->
        <section id="viewChat">
          <div class="topbar">
            <div>
              <div class="title">ğŸ’¬ Chat</div>
              <div class="subtitle">Skriv en frÃ¥ga och fÃ¥ svar â€“ med feedback och loggning.</div>
            </div>

            <div class="topbarActions">
              <button class="btn" id="btnClearChat" type="button">ğŸ§¹ Rensa</button>
              <button class="btn" id="btnExportChat" type="button">â¬‡ï¸ Export</button>
            </div>
          </div>

          <div class="messages" id="chatMessages"></div>

          <div class="composer">
            <input class="input" id="chatInput" placeholder="Skriv ditt meddelande..." />
            <button class="btn primary" id="btnSend" type="button">Skicka</button>
          </div>

          <div class="feedbackRow">
            <span class="muted small">Senaste AI-svar:</span>
            <button class="btn small" id="btnThumbUp" type="button">ğŸ‘ Bra</button>
            <button class="btn small" id="btnThumbDown" type="button">ğŸ‘ DÃ¥ligt</button>
            <span class="muted small" id="feedbackStatus"></span>
          </div>
        </section>

        <!-- =========================
             INBOX VIEW
        ========================== -->
        <section id="viewInbox" style="display:none">
          <div class="topbar">
            <div>
              <div class="title">ğŸ“¥ Inbox</div>
              <div class="subtitle">Nya inkommande Ã¤renden â€“ sortera och skapa tickets.</div>
            </div>

            <div class="topbarActions">
              <select class="input smallInput" id="inboxCategory">
                <option value="">Kategoriâ€¦</option>
                <option value="FakturafrÃ¥ga">FakturafrÃ¥ga</option>
                <option value="Tekniskt fel">Tekniskt fel</option>
                <option value="Avtal">Avtal</option>
                <option value="Ã–vrigt">Ã–vrigt</option>
              </select>

              <button class="btn primary" id="btnCreateTicketFromInbox" type="button">
                â• Skapa ticket
              </button>
            </div>
          </div>

          <div class="split">
            <div class="panel">
              <div class="panelHead">
                <b>Inbox</b>
                <span class="pill warn" id="inboxCountPill">0</span>
              </div>
              <div class="list" id="inboxList"></div>
            </div>

            <div class="panel soft">
              <div class="panelHead">
                <b>FÃ¶rhandsvisning</b>
                <span class="pill" id="inboxSelectedPill">Ingen vald</span>
              </div>

              <div id="inboxPreview">
                <div class="muted small">VÃ¤lj ett inbox-meddelande fÃ¶r att se detaljer.</div>
              </div>

              <div class="divider"></div>

              <label for="inboxNote">Intern anteckning</label>
              <textarea class="input textarea" id="inboxNote" placeholder="Skriv anteckning..."></textarea>
              <div class="row gap" style="margin-top:10px">
                <button class="btn" id="btnSaveInboxNote" type="button">ğŸ’¾ Spara</button>
              </div>
            </div>
          </div>
        </section>

        <!-- =========================
             TICKETS VIEW
        ========================== -->
        <section id="viewTickets" style="display:none">
          <div class="topbar">
            <div>
              <div class="title">ğŸ« Tickets</div>
              <div class="subtitle">Hantera tickets, svara och logga intern info.</div>
            </div>

            <div class="topbarActions">
              <input class="input smallInput" id="ticketSearch" placeholder="SÃ¶k ticket..." />
              <button class="btn" id="btnRefreshTickets" type="button">ğŸ”„ Uppdatera</button>
            </div>
          </div>

          <div class="split">
            <div class="panel">
              <div class="panelHead">
                <b>Ticketlista</b>
                <span class="pill" id="ticketCountPill">0</span>
              </div>
              <div class="list" id="ticketList"></div>
            </div>

            <div class="panel soft">
              <div class="panelHead">
                <b>Ticket</b>
                <span class="pill admin" id="ticketSelectedPill">Ingen vald</span>
              </div>

              <div id="ticketHeaderInfo" class="muted small"></div>

              <div class="divider"></div>

              <div class="ticketDetails" id="ticketThread"></div>

              <div class="divider"></div>

              <label for="ticketReply">Svara (agent)</label>
              <textarea class="input textarea" id="ticketReply" placeholder="Skriv svar..."></textarea>

              <div class="row gap" style="margin-top:10px">
                <button class="btn primary" id="btnSendTicketReply" type="button">ğŸ“¨ Skicka</button>
                <button class="btn" id="btnAIReply" type="button">âœ¨ AI-svar</button>
                <button class="btn danger" id="btnCloseTicket" type="button">âœ… StÃ¤ng</button>
              </div>

              <div class="divider"></div>

              <b>Interna anteckningar</b>
              <div class="noteList" id="ticketNotes"></div>

              <label for="ticketInternalNote">Ny anteckning</label>
              <textarea class="input textarea" id="ticketInternalNote" placeholder="Skriv intern anteckning..."></textarea>
              <div class="row gap" style="margin-top:10px">
                <button class="btn" id="btnAddInternalNote" type="button">â• LÃ¤gg till</button>
              </div>
            </div>
          </div>
        </section>

        <!-- =========================
             ADMIN VIEW
        ========================== -->
        <section id="viewAdmin" style="display:none">
          <div class="topbar">
            <div>
              <div class="title">ğŸ›  Admin</div>
              <div class="subtitle">SLA, kunskapsbas och agent-statistik.</div>
            </div>

            <div class="topbarActions">
              <button class="btn" id="btnAdminRefresh" type="button">ğŸ”„ Uppdatera</button>
            </div>
          </div>

          <div class="tabs">
            <button class="tabBtn active" id="tabSLA" type="button">ğŸ“ˆ SLA</button>
            <button class="tabBtn" id="tabKB" type="button">ğŸ“š Kunskapsbas</button>
            <button class="tabBtn" id="tabAgents" type="button">ğŸ‘¥ Agenter</button>
          </div>

          <!-- SLA TAB -->
          <div id="adminSLA" style="margin-top:12px">
            <div class="slaGrid kpiWide">
              <div class="slaCard">
                <div class="slaLabel">Tickets (totalt)</div>
                <div class="slaValue" id="kpiTotalTickets">0</div>
                <div class="kpiDelta" id="kpiTotalDelta"></div>
              </div>

              <div class="slaCard">
                <div class="slaLabel">Svarstid (median)</div>
                <div class="slaValue" id="kpiMedianResponse">-</div>
                <div class="kpiDelta" id="kpiMedianDelta"></div>
              </div>

              <div class="slaCard">
                <div class="slaLabel">SLA uppfyllt</div>
                <div class="slaValue" id="kpiSlaMet">-</div>
                <div class="kpiDelta" id="kpiSlaDelta"></div>
              </div>

              <div class="slaCard">
                <div class="slaLabel">Ã–ppna tickets</div>
                <div class="slaValue" id="kpiOpenTickets">0</div>
                <div class="kpiDelta" id="kpiOpenDelta"></div>
              </div>
            </div>

            <div style="margin-top:12px" class="card">
              <div class="row" style="justify-content:space-between;align-items:center">
                <div>
                  <b>SLA trend</b>
                  <div class="muted small">Svarstider senaste perioden</div>
                </div>
              </div>

              <div style="margin-top:12px">
                <canvas id="slaTrendChart" height="120"></canvas>
              </div>
            </div>

            <div style="margin-top:12px" class="panel">
              <div class="panelHead">
                <b>Detaljer</b>
              </div>

              <div class="tableWrap">
                <table class="table" id="slaTable">
                  <thead>
                    <tr>
                      <th>Agent</th>
                      <th>Tickets</th>
                      <th>Median svarstid</th>
                      <th>SLA%</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="slaTableBody">
                    <!-- fylls av script.js -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- KB TAB -->
          <div id="adminKB" style="display:none; margin-top:12px">
            <div class="panel">
              <div class="panelHead">
                <b>Kunskapsbas</b>
                <span class="muted small">LÃ¤gg till och redigera artiklar.</span>
              </div>

              <div class="filterBar">
                <input class="input smallInput" id="kbSearch" placeholder="SÃ¶k artikel..." />
                <button class="btn primary" id="btnAddKbArticle" type="button">â• Ny artikel</button>
              </div>

              <div class="kbGrid" id="kbGrid"></div>
            </div>
          </div>

          <!-- Agents TAB -->
          <div id="adminAgents" style="display:none; margin-top:12px">
            <div class="panel">
              <div class="panelHead">
                <b>Agenter</b>
                <span class="muted small">Ã–versikt per agent</span>
              </div>

              <div class="tableWrap">
                <table class="table" id="agentTable">
                  <thead>
                    <tr>
                      <th>Namn</th>
                      <th>Roll</th>
                      <th>Tickets</th>
                      <th>Medel svarstid</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="agentTableBody">
                    <!-- fylls av script.js -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <!-- âœ… Chart.js (om du anvÃ¤nder chart fÃ¶r SLA) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
</body>
</html>
