<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Kundtjänst</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body data-theme="dark">
  <div class="app">

    <!-- TOP BAR -->
    <header class="topbar">
      <div class="brand">
        <div class="logo"><i class="fa-solid fa-headset"></i></div>
        <div class="brandText">
          <div class="brandTitle">AI Kundtjänst</div>
          <div class="brandSub" id="roleBadge">Inte inloggad</div>
        </div>
      </div>

      <div class="topbarRight">
        <div class="categoryWrap">
          <label class="labelSmall">Kategori</label>
          <select id="categorySelect" class="select">
            <option value="demo">Demo AB</option>
            <option value="law">Juridik</option>
            <option value="tech">Teknisk support</option>
            <option value="cleaning">Städservice</option>
          </select>
        </div>

        <button id="themeToggle" class="iconBtn" title="Växla tema">
          <i class="fa-solid fa-moon"></i>
        </button>

        <button id="logoutBtn" class="btn danger" style="display:none;">
          <i class="fa-solid fa-right-from-bracket"></i> Logga ut
        </button>
      </div>
    </header>

    <main class="layout">
      <!-- LEFT SIDEBAR -->
      <aside class="sidebar">
        <div class="card">
          <div class="cardTitle">Meny</div>

          <button id="openChatView" class="menuBtn active">
            <i class="fa-solid fa-comments"></i>
            Chatt
          </button>

          <button id="openInboxView" class="menuBtn" style="display:none;">
            <i class="fa-solid fa-inbox"></i>
            Inbox
          </button>

          <button id="openAdminView" class="menuBtn" style="display:none;">
            <i class="fa-solid fa-user-shield"></i>
            Adminpanel
          </button>

          <div class="divider"></div>

          <button id="exportChatBtn" class="menuBtn">
            <i class="fa-solid fa-file-arrow-down"></i>
            Exportera chatt
          </button>

          <button id="clearChatBtn" class="menuBtn">
            <i class="fa-solid fa-trash"></i>
            Rensa chatt
          </button>

          <div class="divider"></div>

          <button id="toggleDebugBtn" class="menuBtn">
            <i class="fa-solid fa-bug"></i>
            Debug
          </button>

          <div class="tinyNote">
            Byt kategori för att ändra AI:ns “personlighet”.
          </div>
        </div>

        <div id="debugPanel" class="card" style="display:none;">
          <div class="cardTitle">Debug</div>
          <div class="debugRow"><span>Inloggad:</span> <b id="dbgLogged">NEJ</b></div>
          <div class="debugRow"><span>Roll:</span> <b id="dbgRole">-</b></div>
          <div class="debugRow"><span>RAG användes:</span> <b id="dbgRag">-</b></div>
          <div class="debugRow"><span>Ticket ID:</span> <b id="dbgTicket">-</b></div>
          <div class="debugRow"><span>API base:</span> <b id="dbgApi">-</b></div>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <section class="content">

        <!-- AUTH VIEW -->
        <section id="authView" class="view">
          <div class="authCard">
            <h2>Logga in</h2>
            <p class="muted">Logga in eller skapa ett konto för att använda AI Kundtjänst.</p>

            <div class="formGrid">
              <input id="username" class="input" type="text" placeholder="Användarnamn" />
              <input id="password" class="input" type="password" placeholder="Lösenord" />
            </div>

            <div class="row">
              <button id="loginBtn" class="btn primary">
                <i class="fa-solid fa-arrow-right-to-bracket"></i> Logga in
              </button>
              <button id="registerBtn" class="btn secondary">
                <i class="fa-solid fa-user-plus"></i> Registrera
              </button>
            </div>

            <div id="authMessage" class="alert" style="display:none;"></div>
          </div>
        </section>

        <!-- CHAT VIEW -->
        <section id="chatView" class="view" style="display:none;">
          <div class="chatCard">
            <div class="chatHeader">
              <div>
                <div class="chatTitle" id="chatTitle">AI Kundtjänst – Demo AB</div>
                <div class="chatSubtitle" id="chatSubtitle">Ställ en fråga så hjälper jag dig direkt.</div>
              </div>
              <div class="chatHeaderRight">
                <button id="newTicketBtn" class="btn secondary small">
                  <i class="fa-solid fa-plus"></i> Nytt ärende
                </button>
              </div>
            </div>

            <div id="messages" class="messages"></div>

            <div class="composer">
              <input id="messageInput" class="input" type="text" placeholder="Skriv ditt meddelande..." />
              <button id="sendBtn" class="btn primary circle" title="Skicka">
                <i class="fa-solid fa-paper-plane"></i>
              </button>
            </div>

            <div class="hintRow">
              <div class="muted small">
                Tips: tryck <b>Enter</b> för att skicka.
              </div>
            </div>
          </div>
        </section>

        <!-- INBOX VIEW (ADMIN) -->
        <section id="inboxView" class="view" style="display:none;">
          <div class="inboxGrid">

            <div class="card">
              <div class="cardTitle">Inbox</div>

              <div class="row">
                <select id="inboxStatusFilter" class="select">
                  <option value="">Alla status</option>
                  <option value="open">Open</option>
                  <option value="pending">Pending</option>
                  <option value="solved">Solved</option>
                </select>

                <select id="inboxCategoryFilter" class="select">
                  <option value="">Alla kategorier</option>
                  <option value="demo">Demo</option>
                  <option value="law">Law</option>
                  <option value="tech">Tech</option>
                  <option value="cleaning">Cleaning</option>
                </select>

                <button id="inboxRefreshBtn" class="btn secondary">
                  <i class="fa-solid fa-rotate"></i> Uppdatera
                </button>
              </div>

              <div id="inboxMsg" class="alert" style="display:none;margin-top:10px;"></div>
              <div id="inboxTicketsList" class="adminList" style="margin-top:10px;"></div>
            </div>

            <div class="card">
              <div class="cardTitle">Ticket</div>
              <div class="muted small">Välj en ticket i listan för att se hela konversationen.</div>

              <div class="divider"></div>

              <div id="ticketDetails" class="ticketDetails muted small">
                Ingen ticket vald.
              </div>

              <div class="divider"></div>

              <div class="row">
                <button class="btn secondary" id="setStatusOpen"><i class="fa-solid fa-circle"></i> Open</button>
                <button class="btn secondary" id="setStatusPending"><i class="fa-solid fa-clock"></i> Pending</button>
                <button class="btn secondary" id="setStatusSolved"><i class="fa-solid fa-check"></i> Solved</button>
              </div>

              <textarea id="agentReplyTextInbox" class="textarea" placeholder="Skriv agent-svar..."></textarea>
              <button id="sendAgentReplyInboxBtn" class="btn primary">
                <i class="fa-solid fa-reply"></i> Skicka agent-svar
              </button>

              <div id="inboxTicketMsg" class="alert" style="display:none;margin-top:10px;"></div>
            </div>

          </div>
        </section>

        <!-- ADMIN VIEW -->
        <section id="adminView" class="view" style="display:none;">
          <div class="adminGrid">

            <!-- KB MANAGER -->
            <div class="card">
              <div class="cardTitle">Kunskapsdatabas (RAG)</div>
              <div class="muted small" style="margin-bottom:10px;">
                Ladda upp PDF / Text / URL per kategori. AI använder detta automatiskt.
              </div>

              <div class="kbRow">
                <label class="labelSmall">Kategori</label>
                <select id="kbCategorySelect" class="select">
                  <option value="demo">Demo AB</option>
                  <option value="law">Juridik</option>
                  <option value="tech">Teknisk support</option>
                  <option value="cleaning">Städservice</option>
                </select>
              </div>

              <div class="kbTabs">
                <button class="tabBtn active" data-tab="textTab"><i class="fa-solid fa-file-lines"></i> Text</button>
                <button class="tabBtn" data-tab="urlTab"><i class="fa-solid fa-link"></i> URL</button>
                <button class="tabBtn" data-tab="pdfTab"><i class="fa-solid fa-file-pdf"></i> PDF</button>
              </div>

              <div id="textTab" class="tabPanel">
                <input id="kbTextTitle" class="input" placeholder="Titel (t.ex. FAQ / Prislista)" />
                <textarea id="kbTextContent" class="textarea" placeholder="Klistra in text här..."></textarea>
                <button id="kbUploadTextBtn" class="btn primary">
                  <i class="fa-solid fa-upload"></i> Ladda upp text
                </button>
              </div>

              <div id="urlTab" class="tabPanel" style="display:none;">
                <input id="kbUrlInput" class="input" placeholder="Klistra in URL (https://...)" />
                <button id="kbUploadUrlBtn" class="btn primary">
                  <i class="fa-solid fa-upload"></i> Ladda upp URL
                </button>
              </div>

              <div id="pdfTab" class="tabPanel" style="display:none;">
                <input id="kbPdfFile" type="file" accept="application/pdf" class="file" />
                <button id="kbUploadPdfBtn" class="btn primary">
                  <i class="fa-solid fa-upload"></i> Ladda upp PDF
                </button>
              </div>

              <div class="divider"></div>

              <div class="row">
                <button id="kbRefreshBtn" class="btn secondary">
                  <i class="fa-solid fa-rotate"></i> Uppdatera lista
                </button>
                <button id="kbExportBtn" class="btn secondary">
                  <i class="fa-solid fa-download"></i> Exportera KB (JSON)
                </button>
              </div>

              <div class="row">
                <button id="trainingExportBtn" class="btn secondary">
                  <i class="fa-solid fa-database"></i> Export training (Q/A)
                </button>
              </div>

              <div id="kbMsg" class="alert" style="display:none;margin-top:10px;"></div>

              <div class="kbListTitle">Senaste chunks</div>
              <div id="kbList" class="kbList"></div>
            </div>

            <!-- USERS -->
            <div class="card">
              <div class="cardTitle">Användare (Admin)</div>
              <div class="row" style="margin-bottom:10px;">
                <button id="adminUsersRefreshBtn" class="btn secondary">
                  <i class="fa-solid fa-rotate"></i> Ladda users
                </button>
                <button id="adminExportAllBtn" class="btn secondary">
                  <i class="fa-solid fa-box-archive"></i> Export ALLT
                </button>
              </div>

              <div id="adminUsersMsg" class="alert" style="display:none;"></div>
              <div id="adminUsersList" class="adminList"></div>
            </div>

            <!-- HELP -->
            <div class="card">
              <div class="cardTitle">Admin hjälp</div>
              <div class="muted small" style="line-height:1.5;">
                ✅ Inbox = hantera tickets<br/>
                ✅ Adminpanel = KB + Users + Export<br/>
                ✅ Training export = Q/A från tickets<br/><br/>
                För att göra någon admin: klicka på user → “Gör admin”
              </div>
            </div>

          </div>
        </section>

      </section>
    </main>
  </div>

  <script src="script.js"></script>
</body>
</html>
