<!DOCTYPE html>
<html lang="sv">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AI Kundtj√§nst</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style.css?v=2026.12" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body data-theme="light">
  <div class="app">
    <div class="mobile-overlay" onclick="toggleSidebar()"></div>
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"><i class="fa-solid fa-headset"></i></div>
        <div class="brandText">
          <div class="brandTitle">AI Kundtj√§nst</div>
          <div class="brandSub" id="roleBadge">Inte inloggad</div>
        </div>
      </div>

      <div class="sidebarBlock">
        <div class="label">F√∂retag / Kategori</div>
        <select id="categorySelect" class="input">
          <option value="demo">demo</option>
        </select>
      </div>

      <nav class="menu">
        <button id="openChatView" class="menuBtn active" type="button">
          <i class="fa-solid fa-comments"></i> Chat
        </button>

        <button id="openMyTicketsView" class="menuBtn" type="button">
          <i class="fa-solid fa-ticket"></i> Mina √§renden
        </button>

        <button id="openInboxView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-inbox"></i> Inbox (Agent)
          <span id="inboxNotifDot" class="notifDot" style="display:none;"></span>
        </button>

        <button id="openSlaView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-chart-line"></i> SLA & KPI
        </button>

        <button id="openAdminView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-shield-halved"></i> Admin
        </button>

        <button id="openSettingsView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-user-gear"></i> Min Profil & S√§kerhet
        </button>

        <!-- NYA MENYKNAPPAR ‚Äì l√§ggs till sist i menyn -->
        <button id="openCustomerAdminView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-building"></i> Kunder (CRM)
        </button>

        <button id="openBillingView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-credit-card"></i> Abonnemang & Fakturor
        </button>

        <button id="openCustomerSettingsView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-cog"></i> F√∂retagsinst√§llningar
        </button>

        <button id="openSimulatorView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-wand-magic-sparkles"></i> Produktsimulator
        </button>

        <button id="openFeedbackView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-star"></i> Feedback
          <span id="feedbackNotifDot" class="notifDot" style="display:none;"></span>
        </button>

        <button id="openScenarioView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-crystal-ball"></i> Scenarioplanering
        </button>

        <button id="openSalesView" class="menuBtn" style="display:none;" type="button">
          <i class="fa-solid fa-chart-column"></i> S√§ljanalys
        </button>
      </nav>

      <div class="sidebarFooter">
        <button id="themeToggle" class="btn ghost full" type="button">
          <i class="fa-solid fa-moon"></i> Tema
        </button>

        <button id="logoutBtn" class="btn danger full" style="display:none;" type="button">
          <i class="fa-solid fa-right-from-bracket"></i> Logga ut
        </button>

        <button id="toggleDebugBtn" class="btn ghost full" type="button">
          <i class="fa-solid fa-bug"></i> Debug
        </button>
      </div>

      <div id="debugPanel" class="debugPanel" style="display:none;">
        <div><b>API:</b> <span id="dbgApi">-</span></div>
        <div><b>Inloggad:</b> <span id="dbgLogged">-</span></div>
        <div><b>Roll:</b> <span id="dbgRole">-</span></div>
        <div><b>Ticket:</b> <span id="dbgTicket">-</span></div>
        <div><b>RAG:</b> <span id="dbgRag">-</span></div>
      </div>
    </aside>

    <main class="main">

      <div id="toastWrap" class="toastWrap"></div>

      <!-- AUTH VIEW -->
      <section id="authView" class="view">
        <div class="card authCard">
          <h2>Logga in</h2>
          <p class="muted">Logga in f√∂r att starta chatt och se dina √§renden.</p>

          <div class="grid2">
            <div>
              <label>Anv√§ndarnamn</label>
              <input id="username" class="input" placeholder="t.ex. leo123" />
            </div>
            <div>
              <label>Email (f√∂r √•terst√§llning)</label>
              <input id="email" class="input" placeholder="email@exempel.se" />
            </div>
          </div>

          <label>L√∂senord</label>
          <div class="passRow">
            <input id="password" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            <button id="togglePassBtn" class="btn secondary small" type="button"
              onclick="togglePasswordVisibility('password')">
              <i class="fa-solid fa-eye"></i>
            </button>
          </div>

          <div class="row gap">
            <button id="loginBtn" class="btn primary" type="button">
              <i class="fa-solid fa-right-to-bracket"></i> Logga in
            </button>
            <button id="registerBtn" class="btn secondary" type="button">
              <i class="fa-solid fa-user-plus"></i> Registrera
            </button>
          </div>

          <div class="row gap" style="margin-top:10px;">
            <button id="openForgotBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-key"></i> Gl√∂mt l√∂senord?
            </button>
          </div>

          <div id="authMessage" class="alert error" style="display:none;"></div>
        </div>

        <div id="forgotCard" class="card authCard" style="display:none;">
          <h2>√Öterst√§ll l√∂senord</h2>
          <p class="muted">Skriv din email s√• skickas en √•terst√§llningsl√§nk.</p>

          <label>Email</label>
          <input id="forgotEmail" class="input" placeholder="email@exempel.se" />

          <div class="row gap">
            <button id="sendForgotBtn" class="btn primary" type="button">
              <i class="fa-solid fa-paper-plane"></i> Skicka l√§nk
            </button>
            <button id="closeForgotBtn" class="btn ghost" type="button">Avbryt</button>
          </div>

          <div id="forgotMsg" class="alert" style="display:none;"></div>
        </div>

        <div id="resetCard" class="card authCard" style="display:none;">
          <h2>V√§lj nytt l√∂senord</h2>
          <p class="muted">Skriv ett nytt l√∂senord och spara.</p>

          <label>Nytt l√∂senord</label>
          <div class="passRow">
            <input id="resetNewPass" type="password" class="input" placeholder="Nytt l√∂senord" />
            <button id="toggleResetPassBtn" class="btn secondary small" type="button"
              onclick="togglePasswordVisibility('resetNewPass')">
              <i class="fa-solid fa-eye"></i>
            </button>
          </div>

          <button id="resetSaveBtn" class="btn primary full" style="margin-top:10px;" type="button">
            <i class="fa-solid fa-floppy-disk"></i> Spara nytt l√∂senord
          </button>

          <div id="resetMsg" class="alert" style="display:none;"></div>
        </div>
      </section>

      <!-- CHAT VIEW -->
      <section id="chatView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title" id="chatTitle">AI Kundtj√§nst</div>
            <div class="subtitle" id="chatSubtitle">St√§ll en fr√•ga s√• hj√§lper jag dig direkt.</div>
          </div>

          <div class="topbarActions">
            <button id="talkToHumanBtn" class="btn ghost small" title="Prata med en m√§nniska">
              <i class="fa-solid fa-headset"></i> Hj√§lp av m√§nniska
            </button>
            <button id="newTicketBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-circle-plus"></i> Nytt √§rende
            </button>
            <button id="clearChatBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-trash"></i> Rensa
            </button>
          </div>
        </div>

        <div id="messages" class="messages"></div>

        <div id="suggestions" class="suggestions">
          <!-- Suggestion chips added by JS -->
        </div>

        <div class="composer">
          <input id="messageInput" class="input" placeholder="Skriv ditt meddelande..." autocomplete="off" />
          <button id="sendBtn" class="btn primary round" type="button">
            <i class="fa-solid fa-paper-plane"></i>
          </button>
        </div>

        <div class="feedbackRow">
          <button id="fbUp" class="btn ghost small" type="button">
            <i class="fa-solid fa-thumbs-up"></i> Bra
          </button>
          <button id="fbDown" class="btn ghost small" type="button">
            <i class="fa-solid fa-thumbs-down"></i> D√•ligt
          </button>
          <span id="fbMsg" class="muted small"></span>
        </div>
      </section>

      <!-- MY TICKETS VIEW -->
      <section id="myTicketsView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title">Mina √§renden</div>
            <div class="subtitle muted">Se dina tickets och status.</div>
          </div>
          <div class="topbarActions">
            <button id="myTicketsRefreshBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-rotate"></i> Uppdatera
            </button>
          </div>
        </div>

        <div class="split">
          <div class="panel">
            <div class="panelHead">
              <b>Lista</b>
              <span class="muted small" id="myTicketsHint"></span>
            </div>
            <div id="myTicketsList" class="list"></div>
          </div>

          <div class="panel">
            <div class="panelHead">
              <b>Detaljer</b>
            </div>

            <div id="myTicketDetails" class="ticketDetails muted small">
              V√§lj ett √§rende f√∂r att se detaljer.
            </div>

            <div class="divider"></div>

            <label>Skicka meddelande (forts√§tt konversation)</label>
            <textarea id="myTicketReplyText" class="input textarea" placeholder="Skriv ett meddelande..."></textarea>

            <button id="myTicketReplyBtn" class="btn primary full" type="button">
              <i class="fa-solid fa-paper-plane"></i> Skicka
            </button>

            <div id="myTicketReplyMsg" class="alert" style="display:none;"></div>
          </div>
        </div>
      </section>

      <!-- SLA VIEW - ANALYTICS COMMAND CENTER -->
      <section id="slaView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title"><i class="fa-solid fa-chart-pie" style="color:var(--primary);"></i> Analytics Command
              Center</div>
            <div class="subtitle muted">Avancerad statistik, insikter och KPI:er f√∂r hela organisationen</div>
          </div>

          <div class="topbarActions">
            <select id="slaDaysSelect" class="input smallInput">
              <option value="7">7 dagar</option>
              <option value="14">14 dagar</option>
              <option value="30" selected>30 dagar</option>
              <option value="60">60 dagar</option>
              <option value="90">90 dagar</option>
            </select>

            <button id="slaRefreshBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-rotate"></i> Uppdatera
            </button>

            <button id="slaExportCsvBtn" class="btn secondary" type="button">
              <i class="fa-solid fa-file-csv"></i> Export Rapport
            </button>

            <button id="slaClearMyStatsBtn" class="btn danger small" type="button">
              <i class="fa-solid fa-eraser"></i> Rensa min
            </button>

            <button id="slaClearAllStatsBtn" class="btn danger small" type="button" style="display:none;">
              <i class="fa-solid fa-trash"></i> Rensa allt
            </button>
          </div>
        </div>

        <!-- NAVIGATION TABS -->
        <div class="tabs" style="margin-top: 15px;">
          <button class="tabBtn active" data-tab="tabSlaOverview" type="button">
            <i class="fa-solid fa-gauge-high"></i> √ñversikt
          </button>
          <button class="tabBtn" data-tab="tabSlaEscalation" type="button">
            <i class="fa-solid fa-arrow-right-arrow-left"></i> Eskalering
          </button>
          <button class="tabBtn" data-tab="tabSlaQuestions" type="button">
            <i class="fa-solid fa-comments"></i> Fr√•gor & Meddelanden
          </button>
          <button class="tabBtn" data-tab="tabSlaComparison" type="button">
            <i class="fa-solid fa-code-compare"></i> J√§mf√∂relse
          </button>
          <button class="tabBtn" data-tab="tabSlaInsights" type="button">
            <i class="fa-solid fa-lightbulb"></i> Insikter & Tips
          </button>
          <button class="tabBtn" data-tab="tabSlaAgents" type="button">
            <i class="fa-solid fa-trophy"></i> Leaderboard
          </button>
        </div>

        <!-- TAB 1: OVERVIEW DASHBOARD -->
        <div id="tabSlaOverview" class="tabPanel">
          <div id="slaOverviewBox" style="margin-top: 15px;"></div>

          <div class="divider"></div>
          <div class="grid2">
            <div class="panel">
              <div class="panelHead">
                <b><i class="fa-solid fa-chart-line"></i> √Ñrendetrend (veckovis)</b>
              </div>
              <div class="chart-container" style="height: 250px;">
                <canvas id="slaTrendChart"></canvas>
              </div>
            </div>
            <div class="panel">
              <div class="panelHead">
                <b><i class="fa-solid fa-clock"></i> Trafik per timme</b>
              </div>
              <div class="chart-container" style="height: 250px;">
                <canvas id="slaHourlyChart"></canvas>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="grid2">
            <div class="panel">
              <div class="panelHead">
                <b><i class="fa-solid fa-tags"></i> Trendande √Ñmnen</b>
              </div>
              <div id="slaTopTopicsBox" class="list" style="margin-top:10px; max-height: 200px; overflow-y: auto;">
              </div>
            </div>
            <div class="panel">
              <div class="panelHead">
                <b><i class="fa-solid fa-calendar-week"></i> Dagf√∂rdelning</b>
              </div>
              <div id="slaDailyDistribution" style="margin-top:10px;"></div>
            </div>
          </div>
        </div>

        <!-- TAB 2: ESCALATION STATS -->
        <div id="tabSlaEscalation" class="tabPanel" style="display:none;">
          <div class="grid2" style="margin-top: 15px;">
            <div class="panel" style="border-left: 3px solid var(--primary);">
              <div class="panelHead"><b><i class="fa-solid fa-robot"></i> AI vs M√§nniska</b></div>
              <div id="slaEscalationOverview" style="padding: 15px;">
                <div class="muted small center">Laddar eskaleringsstatistik...</div>
              </div>
            </div>
            <div class="panel" style="border-left: 3px solid var(--warning);">
              <div class="panelHead"><b><i class="fa-solid fa-arrow-trend-up"></i> Eskaleringsfl√∂de</b></div>
              <div id="slaEscalationFlow" style="padding: 15px;">
                <div class="slaGrid" style="gap:10px;">
                  <div class="slaCard small">
                    <div class="slaLabel"><i class="fa-solid fa-ticket"></i> Totalt</div>
                    <div class="slaValue" id="escTotalVal">-</div>
                  </div>
                  <div class="slaCard small">
                    <div class="slaLabel"><i class="fa-solid fa-robot"></i> AI L√∂ste</div>
                    <div class="slaValue" id="escAiVal">-</div>
                    <div class="slaDelta up" id="escAiRate">-</div>
                  </div>
                  <div class="slaCard small">
                    <div class="slaLabel"><i class="fa-solid fa-user"></i> Eskalerade</div>
                    <div class="slaValue" id="escHumanVal">-</div>
                    <div class="slaDelta" id="escHumanRate">-</div>
                  </div>
                  <div class="slaCard small">
                    <div class="slaLabel"><i class="fa-solid fa-stopwatch"></i> Tid till Eskalering</div>
                    <div class="slaValue" id="escTimeVal">-</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="panel">
            <div class="panelHead"><b><i class="fa-solid fa-magnifying-glass-chart"></i> Vanligaste
                Eskaleringsorsaker</b></div>
            <div id="slaEscalationReasons" class="list" style="margin-top: 10px;">
              <div class="muted small center">Analyserar orsaker...</div>
            </div>
          </div>
        </div>

        <!-- TAB 3: QUESTION/MESSAGE STATS -->
        <div id="tabSlaQuestions" class="tabPanel" style="display:none;">
          <div id="slaQuestionsOverview" style="margin-top: 15px;">
            <div class="slaGrid">
              <div class="slaCard">
                <div class="slaLabel"><i class="fa-solid fa-message"></i> Totalt Meddelanden</div>
                <div class="slaValue" id="qTotalMessages">-</div>
              </div>
              <div class="slaCard">
                <div class="slaLabel"><i class="fa-solid fa-user"></i> Fr√•n Kunder</div>
                <div class="slaValue" id="qUserMessages">-</div>
              </div>
              <div class="slaCard">
                <div class="slaLabel"><i class="fa-solid fa-robot"></i> AI Svar</div>
                <div class="slaValue" id="qAiMessages">-</div>
              </div>
              <div class="slaCard">
                <div class="slaLabel"><i class="fa-solid fa-headset"></i> Agent Svar</div>
                <div class="slaValue" id="qAgentMessages">-</div>
              </div>
              <div class="slaCard">
                <div class="slaLabel"><i class="fa-solid fa-layer-group"></i> Snitt/Konversation</div>
                <div class="slaValue" id="qAvgConv">-</div>
              </div>
              <div class="slaCard">
                <div class="slaLabel"><i class="fa-solid fa-reply-all"></i> Svar-ratio</div>
                <div class="slaValue" id="qResponseRatio">-</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="grid2">
            <div class="panel">
              <div class="panelHead"><b><i class="fa-solid fa-pie-chart"></i> Fr√•getyper (Kategorisering)</b></div>
              <div id="slaQuestionTypes" class="list" style="margin-top: 10px; max-height: 300px; overflow-y: auto;">
                <div class="muted small center">Analyserar fr√•gor...</div>
              </div>
            </div>
            <div class="panel">
              <div class="panelHead"><b><i class="fa-solid fa-chart-bar"></i> Fr√•gekategorier (Graf)</b></div>
              <div class="chart-container" style="height: 280px;">
                <canvas id="slaQuestionTypesChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB 4: COMPARISON (Period vs Period) -->
        <div id="tabSlaComparison" class="tabPanel" style="display:none;">
          <div class="panel"
            style="margin-top: 15px; background: linear-gradient(135deg, rgba(76, 125, 255, 0.05), rgba(138, 43, 226, 0.05));">
            <div class="panelHead"><b><i class="fa-solid fa-code-compare"></i> Period-j√§mf√∂relse</b></div>
            <p class="muted small" style="margin-bottom: 15px;">J√§mf√∂r nuvarande period med f√∂reg√•ende period f√∂r att se
              trender och utveckling.</p>

            <div id="slaComparisonBox">
              <div class="slaGrid" style="gap: 15px;">
                <!-- Current Period -->
                <div class="slaCard" style="border-top: 3px solid var(--ok);">
                  <div class="slaLabel" style="font-weight:600; color: var(--ok);"><i
                      class="fa-solid fa-calendar-check"></i> Nuvarande Period</div>
                  <div id="compCurrentStats" style="margin-top: 10px;">
                    <div class="muted small">Laddar...</div>
                  </div>
                </div>

                <!-- Previous Period -->
                <div class="slaCard" style="border-top: 3px solid var(--muted);">
                  <div class="slaLabel" style="font-weight:600;"><i class="fa-solid fa-calendar-minus"></i> F√∂reg√•ende
                    Period</div>
                  <div id="compPreviousStats" style="margin-top: 10px;">
                    <div class="muted small">Laddar...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="panel">
            <div class="panelHead"><b><i class="fa-solid fa-arrow-trend-up"></i> F√∂r√§ndring (Deltas)</b></div>
            <div id="slaComparisonDeltas" class="slaGrid" style="margin-top: 15px; gap: 10px;">
              <div class="slaCard small">
                <div class="slaLabel">Totalt</div>
                <div class="slaValue" id="deltaTotal">-</div>
              </div>
              <div class="slaCard small">
                <div class="slaLabel">L√∂sta</div>
                <div class="slaValue" id="deltaSolved">-</div>
              </div>
              <div class="slaCard small">
                <div class="slaLabel">AI L√∂sta</div>
                <div class="slaValue" id="deltaAiSolved">-</div>
              </div>
              <div class="slaCard small">
                <div class="slaLabel">High Priority</div>
                <div class="slaValue" id="deltaHighPriority">-</div>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB 5: AI INSIGHTS & TIPS -->
        <div id="tabSlaInsights" class="tabPanel" style="display:none;">
          <div class="grid2" style="margin-top: 15px;">
            <div class="panel" style="border-left: 3px solid var(--primary);">
              <div class="panelHead"><b><i class="fa-solid fa-brain"></i> AI-Genererade Insikter</b></div>
              <div id="slaInsightsBox" class="list" style="margin-top: 10px;">
                <div class="muted small center">Genererar insikter...</div>
              </div>
            </div>

            <div class="panel" style="border-left: 3px solid var(--warning);">
              <div class="panelHead"><b><i class="fa-solid fa-lightbulb"></i> Tips & Rekommendationer</b></div>
              <div id="slaTipsBox" class="list" style="margin-top: 10px;">
                <div class="muted small center">Laddar tips...</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>
          <div class="panel"
            style="background: linear-gradient(135deg, rgba(55, 214, 122, 0.05), rgba(76, 125, 255, 0.05));">
            <div class="panelHead"><b><i class="fa-solid fa-wand-magic-sparkles"></i> Optimeringsf√∂rslag</b></div>
            <div id="slaOptimizationTips" style="padding: 15px;">
              <div class="alert info" style="margin-bottom: 10px;">
                <i class="fa-solid fa-rocket"></i> <b>Pro-tips f√∂r att √∂ka AI-l√∂sningsgraden:</b>
                <ul style="margin: 10px 0 0 20px; font-size: 13px;">
                  <li>L√§gg till fler FAQ-dokument i kunskapsbasen</li>
                  <li>Anv√§nd tydliga rubriker och strukturerad text</li>
                  <li>Inkludera vanliga fr√•gor och svar fr√•n l√∂sta √§renden</li>
                  <li>Uppdatera regelbundet med ny produktinformation</li>
                </ul>
              </div>
              <div class="alert warn" style="font-size: 12px;">
                <i class="fa-solid fa-clock"></i> <b>SLA Best Practice:</b> Svara p√• high-priority √§renden inom 2 timmar
                f√∂r optimal kundn√∂jdhet.
              </div>
            </div>
          </div>
        </div>

        <!-- TAB 6: AGENT LEADERBOARD -->
        <div id="tabSlaAgents" class="tabPanel" style="display:none;">
          <div class="panel" style="margin-top: 15px;">
            <div class="panelHead">
              <b><i class="fa-solid fa-trophy" style="color: gold;"></i> Agent Performance Leaderboard</b>
              <span class="pill ok" style="margin-left: 10px;">Gamification</span>
            </div>
            <div class="tableWrap" style="margin-top:10px;">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width:40px;">#</th>
                    <th>Agent</th>
                    <th>Hanterade</th>
                    <th>L√∂sta</th>
                    <th>High-Prio</th>
                    <th>Snitt Msgs</th>
                    <th>Effektivitet</th>
                    <th>CSAT</th>
                    <th style="text-align:right;"><i class="fa-solid fa-star" style="color:gold;"></i> Po√§ng</th>
                  </tr>
                </thead>
                <tbody id="slaAgentsTableBody"></tbody>
              </table>
            </div>
          </div>

          <div class="divider"></div>
          <div class="grid2">
            <div class="panel soft">
              <div class="panelHead"><b><i class="fa-solid fa-chart-pie"></i> F√∂rdelning per Agent</b></div>
              <div class="chart-container" style="height: 200px;">
                <canvas id="slaAgentPieChart"></canvas>
              </div>
            </div>
            <div class="panel soft">
              <div class="panelHead"><b><i class="fa-solid fa-medal"></i> Top Performer</b></div>
              <div id="slaTopPerformer" style="padding: 20px; text-align: center;">
                <div class="avatar-large" id="topPerformerAvatar" style="margin: 0 auto;">üèÜ</div>
                <h3 id="topPerformerName" style="margin-top: 10px;">-</h3>
                <div class="muted small" id="topPerformerStats">Laddar...</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- INBOX VIEW -->
      <section id="inboxView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title">Inbox</div>
            <div class="subtitle muted">Hantera inkomna √§renden (agent/admin).</div>
          </div>

          <div class="topbarActions">
            <button id="inboxRefreshBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-rotate"></i> Uppdatera
            </button>

            <button id="solveAllBtn" class="btn secondary" type="button">
              <i class="fa-solid fa-check-double"></i> Solve ALL
            </button>

            <button id="removeSolvedBtn" class="btn danger" type="button">
              <i class="fa-solid fa-trash"></i> Remove solved
            </button>
          </div>
        </div>

        <div class="split">
          <div class="panel">
            <div class="panelHead">
              <b>Tickets</b>
            </div>

            <div class="filterBar">
              <select id="inboxStatusFilter" class="input smallInput">
                <option value="">Alla status</option>
                <option value="open">Open</option>
                <option value="pending">Pending</option>
                <option value="solved">Solved</option>
              </select>

              <select id="inboxCategoryFilter" class="input smallInput">
                <option value="">Alla kategorier</option>
              </select>

              <input id="inboxSearchInput" class="input smallInput" placeholder="S√∂k title/ID/kategori..." />
            </div>

            <div id="inboxMsg" class="alert error" style="display:none;"></div>
            <div id="inboxTicketsList" class="list"></div>
          </div>

          <div class="panel">
            <div class="panelHead">
              <b>Ticket</b>
            </div>

            <div id="inboxTicketMsg" class="alert error" style="display:none;"></div>

            <div class="row gap">
              <button id="setStatusOpen" class="btn ghost small" type="button">Open</button>
              <button id="setStatusPending" class="btn ghost small" type="button">Pending</button>
              <button id="setStatusSolved" class="btn ghost small" type="button">Solved</button>

              <select id="ticketPrioritySelect" class="input smallInput" style="margin-left:auto;">
                <option value="low">Low</option>
                <option value="normal" selected>Normal</option>
                <option value="high">High</option>
              </select>

              <button id="setPriorityBtn" class="btn ghost small" type="button">
                <i class="fa-solid fa-flag"></i> Prioritet
              </button>
            </div>

            <div class="divider"></div>

            <div id="ticketDetails" class="ticketDetails muted small">V√§lj en ticket.</div>

            <div class="divider"></div>

            <label>Agent-svar (syns f√∂r kunden)</label>
            <div class="row gap small" style="margin-bottom:5px;">
              <button class="btn ghost tiny" onclick="useQuickReply('greeting')">Hej</button>
              <button class="btn ghost tiny" onclick="useQuickReply('working')">Jobbar p√• det</button>
              <button class="btn ghost tiny" onclick="useQuickReply('solved')">L√∂st</button>
              <button class="btn ghost tiny" onclick="useQuickReply('thanks')">Tack</button>
            </div>
            <textarea id="agentReplyTextInbox" class="input textarea" placeholder="Skriv ett svar..."></textarea>
            <button id="sendAgentReplyInboxBtn" class="btn primary full" type="button">
              <i class="fa-solid fa-reply"></i> Skicka svar
            </button>

            <div class="divider"></div>

            <label>Intern notering (syns ej f√∂r kunden)</label>
            <textarea id="internalNoteText" class="input textarea" placeholder="Intern note..."></textarea>
            <button id="saveInternalNoteBtn" class="btn secondary full" type="button">
              <i class="fa-solid fa-note-sticky"></i> Spara note
            </button>

            <button id="clearInternalNotesBtn" class="btn danger full" style="margin-top:10px;" type="button">
              <i class="fa-solid fa-trash"></i> Ta bort alla notes
            </button>

            <div class="divider"></div>

            <label>Assign ticket till agent</label>
            <div class="row gap">
              <select id="assignUserSelect" class="input">
                <option value="">V√§lj agent...</option>
              </select>
              <button id="assignTicketBtn" class="btn ghost" type="button">
                <i class="fa-solid fa-user-check"></i> Assign
              </button>
            </div>

            <div class="divider"></div>

            <button id="deleteTicketBtn" class="btn danger full" type="button">
              <i class="fa-solid fa-trash"></i> Ta bort ticket
            </button>
          </div>
        </div>
      </section>

      <!-- ADMIN VIEW -->
      <section id="adminView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title">Admin Dashboard</div>
            <div class="subtitle muted">Hantera users, export, KB, kategorier och AI settings.</div>
          </div>
          <div class="topbarActions">
            <button id="adminExportAllBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-file-export"></i> Export All
            </button>
            <button id="trainingExportBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-brain"></i> Training Export
            </button>
          </div>
        </div>

        <div class="tabs">
          <button class="tabBtn active" data-tab="tabAdminStats" type="button"><i class="fa-solid fa-microchip"></i>
            System Health</button>
          <button class="tabBtn" data-tab="tabUsers" type="button"><i class="fa-solid fa-users-gear"></i> Users</button>
          <button class="tabBtn" data-tab="tabKB" type="button"><i class="fa-solid fa-book"></i> Knowledge Base</button>
          <button class="tabBtn" data-tab="tabCats" type="button"><i class="fa-solid fa-folder-tree"></i>
            Kategorier</button>
          <button class="tabBtn" data-tab="tabAI" type="button"><i class="fa-solid fa-sliders"></i> AI Settings</button>
          <button class="tabBtn" data-tab="tabWidget" type="button"><i class="fa-solid fa-code"></i> Widget</button>
        </div>

        <div id="tabAdminStats" class="tabPanel">
          <div id="diagnosticsBox"></div>
        </div>

        <div id="tabUsers" class="tabPanel" style="display:none;">
          <div class="panel">
            <div class="panelHead">
              <b>Anv√§ndare</b>
              <button id="adminUsersRefreshBtn" class="btn ghost small" style="margin-left:auto;" type="button">
                <i class="fa-solid fa-rotate"></i> Uppdatera
              </button>
            </div>

            <div id="adminUsersMsg" class="alert error" style="display:none;"></div>
            <div id="adminUsersList" class="list"></div>
          </div>
        </div>

        <div id="tabKB" class="tabPanel" style="display:none;">
          <div class="panel">
            <div class="panelHead">
              <b>KB Manager</b>
              <div style="margin-left:auto; display:flex; gap:10px; flex-wrap:wrap;">
                <select id="kbCategorySelect" class="input smallInput">
                  <option value="demo">demo</option>
                </select>
                <button id="kbRefreshBtn" class="btn ghost small" type="button">
                  <i class="fa-solid fa-rotate"></i> Uppdatera
                </button>
                <button id="kbBulkDeleteBtn" class="btn danger small" type="button">
                  <i class="fa-solid fa-trash-can"></i> Rensa Allt
                </button>
              </div>
            </div>

            <div id="kbMsg" class="alert error" style="display:none;"></div>

            <div class="kbGrid">
              <div class="panel soft">
                <b>Upload text</b>
                <input id="kbTextTitle" class="input" placeholder="Titel" />
                <textarea id="kbTextContent" class="input textarea" placeholder="Klistra in text..."></textarea>
                <button id="kbUploadTextBtn" class="btn primary full" type="button">Ladda upp text</button>
              </div>

              <div class="panel soft">
                <b>Upload URL</b>
                <input id="kbUrlInput" class="input" placeholder="https://..." />
                <button id="kbUploadUrlBtn" class="btn primary full" type="button">Ladda upp URL</button>
              </div>

              <div class="panel soft">
                <b>Upload PDF</b>
                <input id="kbPdfFile" type="file" class="input" accept="application/pdf" />
                <button id="kbUploadPdfBtn" class="btn primary full" type="button">Ladda upp PDF</button>
              </div>
            </div>

            <div class="divider"></div>
            <div id="kbList" class="list"></div>
          </div>
        </div>

        <div id="tabCats" class="tabPanel" style="display:none;">
          <div class="panel">
            <div class="panelHead">
              <b>Kategori Manager</b>
              <button id="catsRefreshBtn" class="btn ghost small" style="margin-left:auto;" type="button">
                <i class="fa-solid fa-rotate"></i> Uppdatera
              </button>
            </div>

            <div id="catsMsg" class="alert error" style="display:none;"></div>

            <div class="kbGrid">
              <div class="panel soft">
                <b>Skapa ny kategori</b>
                <input id="newCatKey" class="input" placeholder="key (ex: ecommerce)" />
                <input id="newCatName" class="input" placeholder="Namn (ex: E-handel)" />
                <textarea id="newCatPrompt" class="input textarea" placeholder="System prompt..."></textarea>

                <div class="grid2">
                  <div>
                    <label>Tone</label>
                    <select id="newCatTone" class="input">
                      <option value="professional" selected>professional</option>
                      <option value="friendly">friendly</option>
                      <option value="strict">strict</option>
                    </select>
                  </div>
                  <div>
                    <label>Emojis</label>
                    <select id="newCatEmojis" class="input">
                      <option value="true" selected>till√•t</option>
                      <option value="false">blockera</option>
                    </select>
                  </div>
                </div>

                <button id="createCatBtn" class="btn primary full" type="button">Skapa</button>
              </div>

              <div class="panel soft">
                <b>Lista (edit/delete)</b>
                <div id="catsList" class="list"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="tabAI" class="tabPanel" style="display:none;">
          <div class="panel">
            <div class="panelHead">
              <b>AI Chat Settings</b>
              <button id="aiSettingsRefreshBtn" class="btn ghost small" style="margin-left:auto;" type="button">
                <i class="fa-solid fa-rotate"></i> Uppdatera
              </button>
            </div>

            <div id="aiSettingsMsg" class="alert error" style="display:none;"></div>

            <label>H√§lsningsfras</label>
            <input id="aiGreeting" class="input" placeholder="Hej! üëã Hur kan jag hj√§lpa dig idag?" />

            <label>Tips-text</label>
            <input id="aiTips" class="input" placeholder="Tips: Beskriv problemet tydligt..." />

            <label>Genv√§gar (en per rad)</label>
            <textarea id="aiShortcuts" class="input textarea"
              placeholder="Sp√•ra order&#10;√Ñndra bokning&#10;Faktura"></textarea>

            <button id="aiSettingsSaveBtn" class="btn primary full" style="margin-top:10px;" type="button">
              <i class="fa-solid fa-floppy-disk"></i> Spara AI Settings
            </button>
          </div>
        </div>

        <div id="tabWidget" class="tabPanel" style="display:none;">
          <div class="panel">
            <div class="panelHead">
              <b>Widget (embed)</b>
            </div>

            <div class="muted small">
              Detta √§r en enkel widget du kan ge till kunder att l√§gga p√• deras sida.
            </div>

            <div class="divider"></div>

            <label>Embed kod</label>
            <textarea id="widgetCode" class="input textarea" readonly></textarea>

            <button id="copyWidgetBtn" class="btn secondary full" style="margin-top:10px;" type="button">
              <i class="fa-solid fa-copy"></i> Kopiera embed-kod
            </button>
          </div>
        </div>

      </section>

      <!-- SETTINGS VIEW / PROFILE -->
      <section id="settingsView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title">Mitt Konto & Profil</div>
            <div class="subtitle muted">Hantera personlig information, s√§kerhet och inst√§llningar.</div>
          </div>
          <div class="topbarActions">
            <button id="logoutBtn" class="btn danger small">
              <i class="fa-solid fa-power-off"></i> Logga ut
            </button>
          </div>
        </div>

        <div class="tabs">
          <button class="tabBtn active" data-tab="tabProfile" type="button"><i class="fa-solid fa-user"></i> Min
            Profil</button>
          <button class="tabBtn" data-tab="tabSecurity" type="button"><i class="fa-solid fa-shield-halved"></i>
            S√§kerhet</button>
          <button class="tabBtn" data-tab="tabPreferences" type="button"><i class="fa-solid fa-sliders"></i>
            Inst√§llningar</button>
        </div>

        <!-- PROFILE TAB -->
        <div id="tabProfile" class="tabPanel">
          <div class="grid2">
            <div class="panel">
              <div class="panelHead"><b>Basfakta</b></div>
              <div class="center" style="padding: 20px 0;">
                <div class="avatar-large" id="profileAvatar">??</div>
                <h2 id="profileNameDisplay" style="margin-top:15px; margin-bottom: 5px;">-</h2>
                <div id="profileRoleBadge">-</div>
              </div>

              <label>E-postadress</label>
              <input id="profileEmail" class="input" readonly style="opacity:0.7;" />

              <label>Anv√§ndarnamn</label>
              <div class="row gap">
                <input id="newUsernameInput" class="input" placeholder="Nytt anv√§ndarnamn" />
                <button id="changeUsernameBtn" class="btn secondary">Uppdatera</button>
              </div>
            </div>

            <div class="panel">
              <div class="panelHead"><b>Aktivitet & Status</b></div>
              <div id="roleBasedStats" style="margin-top:15px;">
                <!-- Populated by JS based on role -->
                <div class="muted small center">Laddar statistik...</div>
              </div>

              <div class="divider"></div>
              <b>Senaste inloggning</b>
              <p class="muted small" id="lastLoginDisplay">Idag, 16:42 (Stockholm)</p>
            </div>
          </div>
        </div>

        <!-- SECURITY TAB -->
        <div id="tabSecurity" class="tabPanel" style="display:none;">
          <div class="panel" style="max-width: 500px; margin: 0 auto;">
            <div class="panelHead"><b>√Ñndra L√∂senord</b></div>
            <p class="muted small">V√§lj ett starkt l√∂senord f√∂r att skydda ditt konto.</p>

            <label>Nuvarande L√∂senord</label>
            <input id="currentPassInput" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />

            <label>Nytt L√∂senord</label>
            <input id="newPassInput" type="password" class="input" placeholder="Minst 8 tecken" />

            <button id="changePasswordBtn" class="btn primary full" style="margin-top:20px;">
              <i class="fa-solid fa-key"></i> Uppdatera L√∂senord
            </button>

            <div class="divider"></div>
            <div class="alert warn" style="font-size:12px;">
              <i class="fa-solid fa-circle-info"></i> Vi rekommenderar att du byter l√∂senord var 6:e m√•nad.
            </div>
          </div>
        </div>

        <!-- PREFERENCES TAB -->
        <div id="tabPreferences" class="tabPanel" style="display:none;">
          <div class="panel">
            <div class="panelHead"><b>Applikationsinst√§llningar</b></div>

            <div class="list">
              <div class="listItem" style="justify-content: space-between; display: flex; align-items: center;">
                <div>
                  <b>M√∂rkt l√§ge</b>
                  <p class="muted tiny">V√§xla mellan ljust och m√∂rkt tema.</p>
                </div>
                <button id="themeToggleProfile" class="btn ghost small"><i class="fa-solid fa-moon"></i></button>
              </div>

              <div class="listItem" style="justify-content: space-between; display: flex; align-items: center;">
                <div>
                  <b>Ljudaviseringar</b>
                  <p class="muted tiny">Spela upp ljud vid nya inkommande √§renden.</p>
                </div>
                <input type="checkbox" id="prefSoundNotif" checked />
              </div>

              <div class="listItem" style="justify-content: space-between; display: flex; align-items: center;">
                <div>
                  <b>Spr√•k</b>
                  <p class="muted tiny">V√§lj ditt √∂nskade spr√•k f√∂r gr√§nssnittet.</p>
                </div>
                <select class="input smallInput" style="width: auto;">
                  <option value="sv">Svenska</option>
                  <option value="en">English</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div id="settingsMsg" class="alert" style="display:none;"></div>
      </section>

      <!-- === NYA VYER L√ÑGG TILL H√ÑR ‚Äì l√§ngst ner i main === -->

      <!-- NY: KUND-ADMIN / CRM (f√∂r admin) -->
      <!-- CRM VIEW (UPGRADED AI PRO) -->
      <section id="customerAdminView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title">CRM & F√∂rs√§ljning</div>
            <div class="subtitle muted">Hantera kunder, aff√§rer och pipeline p√• ett st√§lle.</div>
          </div>
          <div class="topbarActions">
            <button id="addDealBtn" class="btn primary" onclick="openDealModal()">
              <i class="fa-solid fa-plus"></i> Ny Aff√§r
            </button>
            <button id="addCustomerBtn" class="btn ghost" onclick="openAddCustomerModal()">
              <i class="fa-solid fa-user-plus"></i> Ny Kund
            </button>
          </div>
        </div>

        <!-- CRM Navigation -->
        <div class="crmNav">
          <button class="crmNavBtn active" onclick="setCrmTab('dashboard')" id="tab_crm_dashboard">√ñversikt</button>
          <button class="crmNavBtn" onclick="setCrmTab('pipeline')" id="tab_crm_pipeline">Pipeline</button>
          <button class="crmNavBtn" onclick="setCrmTab('customers')" id="tab_crm_customers">Kunder</button>
          <button class="crmNavBtn" onclick="setCrmTab('activities')" id="tab_crm_activities">Aktiviteter</button>
        </div>

        <!-- TAB: DASHBOARD -->
        <div id="crm_dashboard" class="crmTabContent">
          <!-- Stats Grid -->
          <div class="crmDashGrid">
            <div class="crmStatCard">
              <div class="crmStatTitle">Total Pipeline V√§rde <i class="fa-solid fa-sack-dollar"></i></div>
              <div class="crmStatValue">2.4 Mkr</div>
              <div class="crmStatTrend up"><i class="fa-solid fa-arrow-trend-up"></i> +12% denna m√•nad</div>
            </div>
            <div class="crmStatCard">
              <div class="crmStatTitle">√ñppna Aff√§rer <i class="fa-solid fa-briefcase"></i></div>
              <div class="crmStatValue">34 st</div>
              <div class="crmStatTrend">7 i f√∂rhandling</div>
            </div>
            <div class="crmStatCard">
              <div class="crmStatTitle">Nya Leads (AI Score > 80) <i class="fa-solid fa-star"></i></div>
              <div class="crmStatValue">12 st</div>
              <div class="crmStatTrend up">3 heta just nu</div>
            </div>
            <div class="crmStatCard">
              <div class="crmStatTitle">M√•natlig Int√§kt (MRR) <i class="fa-solid fa-chart-line"></i></div>
              <div class="crmStatValue" id="crmMonthlyRevenue">0 kr</div>
              <div class="crmStatTrend ok">Total kundbas</div>
            </div>
            <div class="crmStatCard" style="border: 1px solid var(--primary); background: var(--primary-fade);">
              <div class="crmStatTitle" style="color:var(--primary);">AI Insight <i class="fa-solid fa-robot"></i>
              </div>
              <div style="font-size:14px; font-weight:500;">"Du har 5 aff√§rer som stannat av i 'F√∂rhandling'. Skicka
                en uppf√∂ljning idag f√∂r att √∂ka st√§ngningsfrekvensen med 15%."</div>
              <button class="btn primary small" style="margin-top:10px;">Agera nu</button>
            </div>
          </div>

          <!-- Recent Activity List -->
          <div class="panel">
            <div class="panelHead"><b><i class="fa-solid fa-clock-rotate-left"></i> Senaste H√§ndelser</b></div>
            <div class="activityTimeline" style="border-left:none; padding-left:0;">
              <div class="activityItem call" style="padding-left:20px; border-left:2px solid var(--border);">
                <div class="activityMeta">Idag 10:30 ‚Ä¢ Samtal</div>
                <div><b>Maria Andersson</b> (TechCorp) diskuterade avtalsvillkor.</div>
              </div>
              <div class="activityItem email" style="padding-left:20px; border-left:2px solid var(--border);">
                <div class="activityMeta">Ig√•r 14:15 ‚Ä¢ E-post</div>
                <div><b>Johan Svensson</b> √∂ppnade offerten "Q1 Licenser".</div>
              </div>
              <div class="activityItem meeting" style="padding-left:20px; border-left:2px solid var(--border);">
                <div class="activityMeta">Ig√•r 09:00 ‚Ä¢ M√∂te</div>
                <div>Demo med <b>Fastighetsbolaget AB</b> slutf√∂rd. Kund mycket intresserad.</div>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: PIPELINE (KANBAN) -->
        <div id="crm_pipeline" class="crmTabContent" style="display:none;">
          <div class="pipelineContainer">
            <div class="pipelineColumn">
              <div class="pipelineHeader">
                <span>Nytt Lead</span>
                <span class="stageCount">5</span>
              </div>
              <div id="pipelineBody-new" class="pipelineBody" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="dealCard" draggable="true" ondragstart="drag(event)" id="deal1">
                  <div class="dealCompany">LogistikPartner AB</div>
                  <div class="dealValue">250 000 kr</div>
                  <div class="dealFooter">
                    <div class="dealTags"><span class="dealTag tag-hot">HOT</span></div>
                    <div class="dealOwner">MP</div>
                  </div>
                </div>
                <div class="dealCard" draggable="true" ondragstart="drag(event)" id="deal2">
                  <div class="dealCompany">Norrland Transport</div>
                  <div class="dealValue">120 000 kr</div>
                  <div class="dealFooter">
                    <div class="dealTags"><span class="dealTag tag-warm">WARM</span></div>
                    <div class="dealOwner">JS</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="pipelineColumn">
              <div class="pipelineHeader">
                <span>Kvalificerad</span>
                <span class="stageCount">3</span>
              </div>
              <div id="pipelineBody-qualified" class="pipelineBody" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="dealCard" draggable="true" ondragstart="drag(event)" id="deal3">
                  <div class="dealCompany">Byggmax AB</div>
                  <div class="dealValue">450 000 kr</div>
                  <div class="dealFooter">
                    <div class="dealTags"><span class="dealTag tag-cold">COLD</span></div>
                    <div class="dealOwner">MP</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="pipelineColumn">
              <div class="pipelineHeader">
                <span>Offert Skickad</span>
                <span class="stageCount">2</span>
              </div>
              <div id="pipelineBody-proposal" class="pipelineBody" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="dealCard" draggable="true" ondragstart="drag(event)" id="deal4">
                  <div class="dealCompany">TechConsulting</div>
                  <div class="dealValue">85 000 kr</div>
                  <div class="dealFooter">
                    <div class="dealTags"><span class="dealTag tag-hot">HOT</span></div>
                    <div class="dealOwner">SJ</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="pipelineColumn">
              <div class="pipelineHeader">
                <span>F√∂rhandling</span>
                <span class="stageCount">1</span>
              </div>
              <div id="pipelineBody-negotiation" class="pipelineBody" ondrop="drop(event)"
                ondragover="allowDrop(event)">
                <div class="dealCard" draggable="true" ondragstart="drag(event)" id="deal5">
                  <div class="dealCompany">Storbanken SE</div>
                  <div class="dealValue">1 200 000 kr</div>
                  <div class="dealFooter">
                    <div class="dealTags"><span class="dealTag tag-hot">HOT</span></div>
                    <div class="dealOwner">VD</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: CUSTOMERS (List) -->
        <div id="crm_customers" class="crmTabContent" style="display:none;">
          <div class="panel">
            <div class="row" style="margin-bottom:15px; justify-content:space-between;">
              <div class="searchInputs">
                <input class="input" placeholder="S√∂k f√∂retag eller kontakt..." style="width:300px;">
              </div>
              <div class="filters">
                <button class="btn ghost small"><i class="fa-solid fa-filter"></i> Filter</button>
                <button class="btn ghost small"><i class="fa-solid fa-download"></i> Exportera</button>
              </div>
            </div>

            <!-- Summary Bar at Top -->
            <div class="crmSummaryBar"
              style="background:var(--panel2); padding:15px; border-radius:12px; margin-bottom:20px; display:flex; gap:30px; border:1px solid var(--border);">
              <div>
                <div class="muted"
                  style="font-size:11px; text-transform:uppercase; font-weight:bold; letter-spacing:0.5px;">Total
                  m√•nadsint√§kt</div>
                <div id="crmTotalValueHeader" style="font-size:22px; font-weight:800; color:var(--primary);">0 kr</div>
              </div>
              <div>
                <div class="muted"
                  style="font-size:11px; text-transform:uppercase; font-weight:bold; letter-spacing:0.5px;">Aktiva
                  kunder</div>
                <div id="crmTotalCustomersHeader" style="font-size:22px; font-weight:800; color:var(--text);">0 st</div>
              </div>
            </div>
            <table class="crmTable" style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: var(--panel2);">
                  <th style="padding: 12px; text-align: left;">F√∂retag</th>
                  <th style="padding: 12px; text-align: left;">Kontakt & Org.nr</th>
                  <th style="padding: 12px; text-align: left;">Status</th>
                  <th style="padding: 12px; text-align: right;">Totalt V√§rde</th>
                  <th style="padding: 12px; text-align: center;">AI Score</th>
                  <th style="padding: 12px; text-align: right;">√Ötg√§rd</th>
                </tr>
              </thead>
              <tbody id="crmAnalyticsTable">
                <tr onclick="openCustomerModal('TechCorp')"
                  style="cursor:pointer; border-bottom:1px solid var(--border);">
                  <td style="padding:12px;"><b>TechCorp AB</b><br><span class="muted small">IT-Konsult</span></td>
                  <td style="padding:12px;">Maria Andersson<br><span class="muted small">maria@techcorp.se</span>
                  </td>
                  <td style="padding:12px;"><span class="pill ok">Kund</span></td>
                  <td style="padding:12px; text-align:right;">1.2 Mkr</td>
                  <td style="padding:12px; text-align:center;"><span
                      style="color:var(--success); font-weight:bold;">92</span></td>
                  <td style="padding:12px; text-align:right;">
                    <button class="btn ghost small icon"><i class="fa-solid fa-phone"></i></button>
                    <button class="btn ghost small icon"><i class="fa-solid fa-envelope"></i></button>
                  </td>
                </tr>
                <tr onclick="openCustomerModal('Norrland')"
                  style="cursor:pointer; border-bottom:1px solid var(--border);">
                  <td style="padding:12px;"><b>Norrland Transport</b><br><span class="muted small">Logistik</span>
                  </td>
                  <td style="padding:12px;">Per Persson<br><span class="muted small">per@norrland.se</span></td>
                  <td style="padding:12px;"><span class="pill warn">F√∂rhandling</span></td>
                  <td style="padding:12px; text-align:right;">450 000 kr</td>
                  <td style="padding:12px; text-align:center;"><span style="color:orange; font-weight:bold;">65</span>
                  </td>
                  <td style="padding:12px; text-align:right;">
                    <button class="btn ghost small icon"><i class="fa-solid fa-phone"></i></button>
                    <button class="btn ghost small icon"><i class="fa-solid fa-envelope"></i></button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- TAB: ACTIVITIES -->
        <div id="crm_activities" class="crmTabContent" style="display:none;">
          <div class="panel">
            <div class="panelHead"><b>Kommande Aktiviteter</b></div>
            <div
              style="background:var(--panel2); padding:40px; text-align:center; border-radius:8px; color:var(--text-muted);">
              <i class="fa-solid fa-calendar-days" style="font-size:32px; margin-bottom:10px;"></i>
              <p>Kalenderintegration kommer snart.</p>
            </div>
          </div>
        </div>

        <!-- 360 MODAL (MOVED INSIDE SECTION FOR CLEANER REPLACE) -->
        <div id="crmCustomerModal" class="modal" style="display: none;">
          <div class="modalContent"
            style="width: 900px; max-width: 95vw; height: 85vh; overflow:hidden; display:flex; flex-direction:column;">
            <div class="modalHeader">
              <h3><i class="fa-solid fa-building"></i> <span id="crmModalCustomerName">Kunddetaljer</span></h3>
              <div class="modalActions">
                <button id="crmCloseModalBtn" class="btn ghost small" onclick="closeCrmModal('crmCustomerModal')"><i
                    class="fa-solid fa-times"></i></button>
              </div>
            </div>
            <div class="modalBody" id="crmModalBody" style="padding:0; flex:1; overflow:hidden;">
              <div class="customerProfileLayout">
                <div class="customerSidebar" style="border-right:1px solid var(--border); border-radius:0;">
                  <div class="topInfo" style="text-align:center; margin-bottom:20px;">
                    <div class="avatar-large"
                      style="width:80px; height:80px; margin:0 auto 10px; background:#e0e7ff; color:var(--primary); font-size:32px; display:flex; align-items:center; justify-content:center; border-radius:50%;">
                      C</div>
                    <h2 style="font-size:20px; margin:0;">Kundnamn</h2>
                    <p class="muted">Bransch ‚Ä¢ Stad</p>
                    <div class="pill ok" style="margin-top:5px;">Status</div>
                  </div>
                  <div class="aiInsightBox">
                    <div
                      style="font-size:12px; text-transform:uppercase; color:var(--primary); font-weight:bold; margin-bottom:5px;">
                      AI Lead Score</div>
                    <div class="aiScore">--</div>
                  </div>
                </div>
                <div class="customerMain" style="border:none; border-radius:0; overflow-y:auto; padding:20px;">
                  <p class="muted center">V√§lj en kund f√∂r att se detaljer.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section><!-- SETTINGS VIEW / PROFILE -->
      <section id="settingsView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title">Inst√§llningar & Profil</div>
          </div>
        </div>

        <div class="grid2">
          <div class="panel">
            <div class="panelHead"><b><i class="fa-solid fa-user"></i> Profil</b></div>

            <div class="row gap" style="margin-top:15px; margin-bottom:15px;">
              <div id="profileAvatar" class="avatar-large"
                style="width:64px; height:64px; font-size:24px; display:flex; align-items:center; justify-content:center; background:var(--primary); color:white; border-radius:50%;">
                XX</div>
              <div style="flex:1">
                <div id="profileNameDisplay" class="title" style="font-size:20px;">Anv√§ndarnamn</div>
                <span id="profileRoleBadge" class="badge">Roll</span>
              </div>
            </div>

            <label>E-post</label>
            <input id="profileEmail" class="input" disabled />

            <label>Anv√§ndarnamn</label>
            <input id="newUsernameInput" class="input" />
            <button id="changeUsernameBtn" class="btn secondary full" style="margin-top:10px;">Byt anv√§ndarnamn</button>
          </div>

          <div class="panel">
            <div class="panelHead"><b><i class="fa-solid fa-lock"></i> S√§kerhet</b></div>
            <p class="muted small">H√§r kan du byta ditt l√∂senord.</p>

            <label>Nuvarande l√∂senord</label>
            <div class="passRow" style="display:flex; gap:8px;">
              <input id="currentPassInput" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              <button onclick="togglePasswordVisibility('currentPassInput')" class="btn secondary small"
                type="button"><i class="fa-solid fa-eye"></i></button>
            </div>

            <label>Nytt l√∂senord</label>
            <div class="passRow" style="display:flex; gap:8px; margin-top:10px;">
              <input id="newPassInput" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              <button onclick="togglePasswordVisibility('newPassInput')" class="btn secondary small" type="button"><i
                  class="fa-solid fa-eye"></i></button>
            </div>

            <button id="changePasswordBtn" class="btn primary full" style="margin-top:20px;">
              <i class="fa-solid fa-floppy-disk"></i> Uppdatera l√∂senord
            </button>
          </div>
        </div>

        <div id="roleBasedStats" style="margin-top:20px;"></div>
      </section>

      <!-- NY: BILLING / ABONNEMANG -->
      <section id="billingView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title">Billing & Abonnemang</div>
            <div class="subtitle muted">Hantera din prisplan, fakturor och f√∂rbrukning.</div>
          </div>
          <div class="topbarActions">
            <button id="manageBillingBtn" class="btn ghost">
              <i class="fa-solid fa-credit-card"></i> Betalningsmetod
            </button>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Billing Stats / Status -->
        <div class="slaGrid">
          <div class="slaCard">
            <div class="slaLabel"><i class="fa-solid fa-gem"></i> Nuvarade Plan</div>
            <div class="slaValue" id="currentPlanName">Laddar...</div>
            <div class="slaDelta up" id="currentPlanStatus">Aktivt</div>
          </div>
          <div class="slaCard">
            <div class="slaLabel"><i class="fa-solid fa-bolt"></i> AI F√∂rbrukning</div>
            <div class="slaValue" id="billingUsageVal">64%</div>
            <div class="slaDelta small" id="billingUsageLabel">320 / 500 meddelanden</div>
          </div>
          <div class="slaCard">
            <div class="slaLabel"><i class="fa-solid fa-calendar-check"></i> N√§sta faktura</div>
            <div class="slaValue" id="nextBillingDate">24 Mars</div>
            <div class="slaDelta small">Auto-f√∂rnyelse aktiv</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid2">
          <!-- Pricing & Features -->
          <div class="panel">
            <div class="panelHead"><b><i class="fa-solid fa-layer-group"></i> Dina F√∂rm√•ner & Upgrade</b></div>

            <div class="activePlanBox" id="activePlanBox"
              style="margin-top:15px; background: rgba(76, 125, 255, 0.05); border: 1px dashed var(--primary); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
              <div class="row gap">
                <div class="title" style="font-size: 18px;">Din nuvarande plan: <span id="activePlanLabel">-</span>
                </div>
                <div class="pill ok">AKTIV</div>
              </div>
              <ul class="featureList" id="activePlanFeatures"
                style="margin-top:10px; list-style:none; padding:0; display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                <!-- Populated by JS -->
              </ul>
            </div>

            <div class="list" style="gap:16px;">
              <div class="listItem pricingCard" id="planCardBas" style="padding: 16px; position:relative;">
                <div class="title" style="font-size: 18px;">BAS</div>
                <p class="muted small">Perfekt f√∂r sm√•f√∂retag som vill testa AI-support.</p>
                <div style="font-size: 22px; font-weight: 900; margin: 10px 0;">0 kr <span class="muted small"
                    style="font-weight:400">/ m√•n</span></div>
                <ul class="featureList">
                  <li><i class="fa-solid fa-check"></i> 500 meddelanden</li>
                  <li><i class="fa-solid fa-check"></i> 1 Agent-konto</li>
                  <li><i class="fa-solid fa-check"></i> Widget access</li>
                </ul>
                <button class="btn ghost full" style="margin-top: 15px;" disabled>Nuvarande plan</button>
              </div>

              <div class="listItem pricingCard" id="planCardPro"
                style="padding: 16px; border-top: 2px solid var(--primary); position:relative;">
                <div class="row gap">
                  <div class="title" style="font-size: 20px;">PRO</div>
                  <div class="pill ok">Rekommenderas</div>
                </div>
                <p class="muted small">V√•rt mest popul√§ra paket f√∂r v√§xande team.</p>
                <div style="font-size: 24px; font-weight: 900; margin: 10px 0;">499 kr <span class="muted small"
                    style="font-weight:400">/ m√•n</span></div>
                <ul class="featureList">
                  <li><i class="fa-solid fa-check"></i> 5000 meddelanden</li>
                  <li><i class="fa-solid fa-check"></i> GPT-4 Turbo Access</li>
                  <li><i class="fa-solid fa-check"></i> Obegr√§nsat med agenter</li>
                  <li><i class="fa-solid fa-check"></i> Premium Analytics</li>
                </ul>
                <button id="upgradeToProBtn" class="btn primary full" style="margin-top: 15px;">Uppgradera till
                  Professional</button>
              </div>
            </div>
          </div>

          <!-- Invoice History & Billing Actions -->
          <div class="panel">
            <div class="panelHead"><b><i class="fa-solid fa-file-invoice-dollar"></i> Fakturahistorik</b></div>
            <div class="tableWrap" style="margin-top:10px;">
              <table class="table">
                <thead>
                  <tr>
                    <th>Datum</th>
                    <th>Belopp</th>
                    <th>Status</th>
                    <th style="text-align:right">Kvitto</th>
                  </tr>
                </thead>
                <tbody id="billingHistoryList">
                  <!-- Invoices populated by JS -->
                </tbody>
              </table>
            </div>

            <div class="divider"></div>
            <div class="panel soft" style="background: rgba(255,255,255,0.02)">
              <b>Inst√§llningar</b>
              <p class="muted small">Hantera sparade kort och f√∂retagsinformation.</p>
              <button id="manageBillingBtn" class="btn secondary full" style="margin-top:10px;">
                <i class="fa-solid fa-external-link"></i> √ñppna Stripe Portal
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- NY: KUND-INST√ÑLLNINGAR + SIMULATOR -->
      <section id="customerSettingsView" class="view" style="display:none;">
        <div class="topbar">
          <div class="title">Mina F√∂retagsinst√§llningar</div>
        </div>

        <div class="panel">
          <label>H√§lsningsfras</label>
          <input id="custGreeting" class="input" placeholder="Hej! Hur kan vi hj√§lpa dig?" />

          <label>Ton</label>
          <select id="custTone" class="input">
            <option value="professional">Professionell</option>
            <option value="friendly">V√§nlig</option>
            <option value="strict">Str√§ng</option>
          </select>

          <label>Widget-f√§rg (hex)</label>
          <input id="custWidgetColor" type="color" value="#0066cc" />

          <button id="saveCustomerSettingsBtn" class="btn primary full">Spara</button>

          <div class="divider"></div>

          <h4>Simulator / F√∂rhandsvisning</h4>
          <div id="settingsSimulator" class="chat-preview"
            style="border:1px solid #444; padding:15px; border-radius:12px; min-height:120px;">
            <div class="msg ai">F√∂rhandsvisning laddas...</div>
          </div>
        </div>
      </section>

      <!-- PRODUCT VISUALIZATION SIMULATOR -->
      <section id="simulatorView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title"><i class="fa-solid fa-wand-magic-sparkles" style="color:var(--primary);"></i>
              Produktsimulator</div>
            <div class="subtitle muted">Visualisera produkter i verkliga milj√∂er med AI</div>
          </div>
          <div class="topbarActions">
            <button id="simResetBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-rotate-left"></i> B√∂rja om
            </button>
          </div>
        </div>

        <div class="grid2" style="margin-top: 15px;">
          <!-- LEFT: INPUT PANEL -->
          <div class="panel" style="border-left: 3px solid var(--primary);">
            <div class="panelHead"><b><i class="fa-solid fa-cube"></i> Steg 1: Produkt</b></div>

            <div class="sim-step" style="margin-top: 15px;">
              <label>Produktnamn / Beskrivning</label>
              <input id="simProductName" class="input" placeholder="T.ex. Modern taklampa med m√§ssingdetaljer" />

              <label style="margin-top: 15px;">Produktkategori</label>
              <select id="simProductCategory" class="input">
                <option value="furniture">M√∂bler</option>
                <option value="lighting">Belysning</option>
                <option value="decor">Heminredning</option>
                <option value="electronics">Elektronik</option>
                <option value="art">Konst & Tavlor</option>
                <option value="appliances">Vitvaror</option>
                <option value="outdoor">Utem√∂bler</option>
                <option value="other">√ñvrigt</option>
              </select>

              <label style="margin-top: 15px;">Produktbild (valfritt)</label>
              <div class="file-upload-zone" id="simProductDropzone"
                onclick="document.getElementById('simProductFile').click()">
                <i class="fa-solid fa-cloud-arrow-up"
                  style="font-size: 32px; color: var(--primary); margin-bottom: 10px;"></i>
                <p class="muted small">Dra och sl√§pp eller klicka f√∂r att ladda upp</p>
                <p class="muted tiny">PNG, JPG, WEBP (max 5MB)</p>
                <input type="file" id="simProductFile" accept="image/*" style="display: none;" />
              </div>
              <div id="simProductPreview" class="image-preview" style="display:none;"></div>
            </div>

            <div class="divider"></div>

            <div class="panelHead"><b><i class="fa-solid fa-home"></i> Steg 2: Rum / Milj√∂</b></div>

            <div class="sim-step" style="margin-top: 15px;">
              <div class="row gap" style="margin-bottom: 15px;">
                <button id="simRoomTypeCustom" class="btn secondary active" type="button"
                  onclick="setSimRoomType('custom')">
                  <i class="fa-solid fa-upload"></i> Egen bild
                </button>
                <button id="simRoomTypeAi" class="btn ghost" type="button" onclick="setSimRoomType('ai')">
                  <i class="fa-solid fa-wand-sparkles"></i> AI-genererad
                </button>
              </div>

              <div id="simRoomCustom">
                <label>Ladda upp din rumbild</label>
                <div class="file-upload-zone" id="simRoomDropzone"
                  onclick="document.getElementById('simRoomFile').click()">
                  <i class="fa-solid fa-image" style="font-size: 32px; color: var(--ok); margin-bottom: 10px;"></i>
                  <p class="muted small">Dra och sl√§pp eller klicka f√∂r att ladda upp</p>
                  <p class="muted tiny">Bild p√• rummet d√§r produkten ska placeras</p>
                  <input type="file" id="simRoomFile" accept="image/*" style="display: none;" />
                </div>
                <div id="simRoomPreview" class="image-preview" style="display:none;"></div>
              </div>

              <div id="simRoomAi" style="display: none;">
                <label>Beskriv rummet</label>
                <textarea id="simRoomDescription" class="input textarea"
                  placeholder="T.ex. Modernt vardagsrum med vita v√§ggar, tr√§tak, stora f√∂nster och minimalistisk inredning"></textarea>

                <label style="margin-top: 15px;">Rumstyp</label>
                <select id="simRoomType" class="input">
                  <option value="living_room">Vardagsrum</option>
                  <option value="bedroom">Sovrum</option>
                  <option value="kitchen">K√∂k</option>
                  <option value="bathroom">Badrum</option>
                  <option value="office">Kontor</option>
                  <option value="outdoor">Utomhus / Terrass</option>
                </select>

                <label style="margin-top: 15px;">Stil</label>
                <select id="simRoomStyle" class="input">
                  <option value="modern">Modern / Minimalistisk</option>
                  <option value="scandinavian">Skandinavisk</option>
                  <option value="industrial">Industriell</option>
                  <option value="classic">Klassisk / Traditionell</option>
                  <option value="bohemian">Bohemisk</option>
                  <option value="rustic">Rustik / Lantlig</option>
                </select>
              </div>
            </div>

            <div class="divider"></div>

            <div class="panelHead"><b><i class="fa-solid fa-sliders"></i> Steg 3: Inst√§llningar</b></div>

            <div class="sim-step" style="margin-top: 15px;">
              <label>Placering i rummet</label>
              <select id="simPlacement" class="input">
                <option value="center">Centralt i rummet</option>
                <option value="corner">I ett h√∂rn</option>
                <option value="wall">Mot v√§gg</option>
                <option value="ceiling">I taket (f√∂r lampor)</option>
                <option value="floor">P√• golvet</option>
                <option value="table">P√• bord / Yta</option>
              </select>

              <label style="margin-top: 15px;">Ljuss√§ttning</label>
              <select id="simLighting" class="input">
                <option value="daylight">Dagsljus</option>
                <option value="warm">Varmt ljus (kv√§ll)</option>
                <option value="cool">Kallt ljus</option>
                <option value="dramatic">Dramatiskt / Spotligt</option>
              </select>

              <label style="margin-top: 15px;">Kameravinkel</label>
              <select id="simAngle" class="input">
                <option value="front">Framifr√•n</option>
                <option value="angle">Snett vinkel (45¬∞)</option>
                <option value="wide">Vidvinkel (hela rummet)</option>
                <option value="close">N√§rbild p√• produkten</option>
              </select>
            </div>

            <div class="divider"></div>

            <button id="simGenerateBtn" class="btn primary full" style="padding: 16px; font-size: 16px;" type="button">
              <i class="fa-solid fa-wand-magic-sparkles"></i> Generera Visualisering
            </button>

            <div id="simStatus" class="alert info" style="display: none; margin-top: 15px;">
              <i class="fa-solid fa-spinner fa-spin"></i> <span id="simStatusText">Genererar...</span>
            </div>
          </div>

          <!-- RIGHT: RESULT PANEL -->
          <div class="panel" style="border-left: 3px solid var(--ok);">
            <div class="panelHead">
              <b><i class="fa-solid fa-image"></i> Resultat</b>
              <div style="margin-left: auto; display: flex; gap: 8px;">
                <button id="simDownloadBtn" class="btn ghost small" style="display:none;" type="button">
                  <i class="fa-solid fa-download"></i> Ladda ner
                </button>
                <button id="simShareBtn" class="btn ghost small" style="display:none;" type="button">
                  <i class="fa-solid fa-share"></i> Dela
                </button>
              </div>
            </div>

            <div id="simResultContainer" style="margin-top: 15px;">
              <div id="simResultPlaceholder" class="sim-placeholder">
                <i class="fa-solid fa-image" style="font-size: 64px; color: var(--muted); margin-bottom: 20px;"></i>
                <h3 style="color: var(--muted);">Ingen visualisering √§nnu</h3>
                <p class="muted small" style="max-width: 300px; text-align: center;">
                  Fyll i produktinformation och klicka p√• "Generera Visualisering" f√∂r att se hur din produkt ser ut i
                  en milj√∂.
                </p>
              </div>

              <div id="simResultImage" style="display: none;">
                <img id="simResultImg" src="" alt="Produktvisualisering"
                  style="width: 100%; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" />
              </div>
            </div>

            <div class="divider"></div>

            <div class="panelHead"><b><i class="fa-solid fa-clock-rotate-left"></i> Tidigare Visualiseringar</b></div>
            <div id="simHistory" class="sim-history" style="margin-top: 10px;">
              <div class="muted small center" style="padding: 20px;">Inga tidigare visualiseringar</div>
            </div>

            <div class="divider"></div>

            <div class="alert info" style="font-size: 12px;">
              <i class="fa-solid fa-lightbulb"></i> <b>Tips:</b> F√∂r b√§sta resultat, beskriv produkten detaljerat och
              anv√§nd h√∂gkvalitativa bilder. AI:n fungerar b√§st med tydliga beskrivningar av f√§rg, material och storlek.
            </div>
          </div>
        </div>
      </section>

      <!-- FEEDBACK SYSTEM -->
      <section id="feedbackView" class="view" style="display:none;">
        <div class="topbar">
          <div>
            <div class="title"><i class="fa-solid fa-star" style="color:var(--warn);"></i> Feedback Center</div>
            <div class="subtitle muted">Analysera kundfeedback och f√∂rb√§ttra er service</div>
          </div>
          <div class="topbarActions">
            <button id="refreshFeedbackBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-rotate"></i> Uppdatera
            </button>
            <button id="clearFeedbackBtn" class="btn danger" style="display:none;" type="button">
              <i class="fa-solid fa-trash"></i> Rensa
            </button>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="statsRow"
          style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin: 20px 0;">
          <div class="statCard panel" style="text-align: center; padding: 20px;">
            <div class="statIcon" style="font-size: 32px; color: var(--warn); margin-bottom: 10px;">
              <i class="fa-solid fa-star"></i>
            </div>
            <div id="fbStatAvg" class="statValue" style="font-size: 36px; font-weight: 800;">-</div>
            <div class="statLabel muted">Snittbetyg</div>
          </div>
          <div class="statCard panel" style="text-align: center; padding: 20px;">
            <div class="statIcon" style="font-size: 32px; color: var(--primary); margin-bottom: 10px;">
              <i class="fa-solid fa-comments"></i>
            </div>
            <div id="fbStatTotal" class="statValue" style="font-size: 36px; font-weight: 800;">0</div>
            <div class="statLabel muted">Totalt feedback</div>
          </div>
          <div class="statCard panel" style="text-align: center; padding: 20px;">
            <div class="statIcon" style="font-size: 32px; color: var(--ok); margin-bottom: 10px;">
              <i class="fa-solid fa-user-tie"></i>
            </div>
            <div id="fbStatAgents" class="statValue" style="font-size: 36px; font-weight: 800;">0</div>
            <div class="statLabel muted">Agent-feedback</div>
          </div>
          <div class="statCard panel" style="text-align: center; padding: 20px;">
            <div class="statIcon" style="font-size: 32px; color: var(--primary); margin-bottom: 10px;">
              <i class="fa-solid fa-robot"></i>
            </div>
            <div id="fbStatAi" class="statValue" style="font-size: 36px; font-weight: 800;">0</div>
            <div class="statLabel muted">AI-feedback</div>
          </div>
        </div>

        <div class="grid2" style="margin-top: 15px;">
          <!-- Left Panel: Filters & AI Analysis -->
          <div>
            <!-- Filters -->
            <div class="panel">
              <div class="panelHead"><b><i class="fa-solid fa-filter"></i> Filter</b></div>
              <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 15px;">
                <div style="flex: 1; min-width: 150px;">
                  <label class="small muted">Period</label>
                  <select id="fbPeriodFilter" class="input">
                    <option value="7">Senaste 7 dagar</option>
                    <option value="30" selected>Senaste 30 dagar</option>
                    <option value="90">Senaste 90 dagar</option>
                    <option value="365">Senaste √•ret</option>
                    <option value="all">Alla tider</option>
                  </select>
                </div>
                <div style="flex: 1; min-width: 150px;">
                  <label class="small muted">Typ</label>
                  <select id="fbTypeFilter" class="input">
                    <option value="">Alla typer</option>
                    <option value="agent">Agent-feedback</option>
                    <option value="ai">AI-feedback</option>
                  </select>
                </div>
                <div id="fbAgentFilterWrap" style="flex: 1; min-width: 150px; display: none;">
                  <label class="small muted">Agent</label>
                  <select id="fbAgentFilter" class="input">
                    <option value="">Alla agenter</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- AI Analysis Panel -->
            <div class="panel" style="margin-top: 16px; border-left: 3px solid var(--primary);">
              <div class="panelHead">
                <b><i class="fa-solid fa-wand-sparkles"></i> AI-Analys & Tips</b>
                <button id="getAiAnalysisBtn" class="btn ghost small" style="margin-left: auto;" type="button">
                  <i class="fa-solid fa-sparkles"></i> Generera
                </button>
              </div>
              <div id="aiAnalysisContent" style="margin-top: 15px;">
                <div class="muted" style="text-align: center; padding: 30px;">
                  <i class="fa-solid fa-lightbulb"
                    style="font-size: 40px; color: var(--warn); margin-bottom: 15px; display: block;"></i>
                  Klicka p√• "Generera" f√∂r att f√• AI-drivna insikter och f√∂rb√§ttringstips baserat p√• er feedback.
                </div>
              </div>
            </div>

            <!-- Rating Distribution -->
            <div class="panel" style="margin-top: 16px;">
              <div class="panelHead"><b><i class="fa-solid fa-chart-bar"></i> Betygsf√∂rdelning</b></div>
              <div id="ratingDistribution" style="margin-top: 15px;">
                <div class="ratingBar" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                  <span style="width: 60px;">5 <i class="fa-solid fa-star" style="color: var(--warn);"></i></span>
                  <div style="flex: 1; background: var(--panel2); border-radius: 4px; height: 20px; overflow: hidden;">
                    <div id="rating5Bar"
                      style="height: 100%; background: linear-gradient(90deg, var(--ok), #34d399); width: 0%; transition: width 0.5s;">
                    </div>
                  </div>
                  <span id="rating5Count" style="width: 40px; text-align: right;">0</span>
                </div>
                <div class="ratingBar" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                  <span style="width: 60px;">4 <i class="fa-solid fa-star" style="color: var(--warn);"></i></span>
                  <div style="flex: 1; background: var(--panel2); border-radius: 4px; height: 20px; overflow: hidden;">
                    <div id="rating4Bar"
                      style="height: 100%; background: linear-gradient(90deg, #84cc16, #a3e635); width: 0%; transition: width 0.5s;">
                    </div>
                  </div>
                  <span id="rating4Count" style="width: 40px; text-align: right;">0</span>
                </div>
                <div class="ratingBar" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                  <span style="width: 60px;">3 <i class="fa-solid fa-star" style="color: var(--warn);"></i></span>
                  <div style="flex: 1; background: var(--panel2); border-radius: 4px; height: 20px; overflow: hidden;">
                    <div id="rating3Bar"
                      style="height: 100%; background: linear-gradient(90deg, var(--warn), #fcd34d); width: 0%; transition: width 0.5s;">
                    </div>
                  </div>
                  <span id="rating3Count" style="width: 40px; text-align: right;">0</span>
                </div>
                <div class="ratingBar" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                  <span style="width: 60px;">2 <i class="fa-solid fa-star" style="color: var(--warn);"></i></span>
                  <div style="flex: 1; background: var(--panel2); border-radius: 4px; height: 20px; overflow: hidden;">
                    <div id="rating2Bar"
                      style="height: 100%; background: linear-gradient(90deg, #f97316, #fb923c); width: 0%; transition: width 0.5s;">
                    </div>
                  </div>
                  <span id="rating2Count" style="width: 40px; text-align: right;">0</span>
                </div>
                <div class="ratingBar" style="display: flex; align-items: center; gap: 10px;">
                  <span style="width: 60px;">1 <i class="fa-solid fa-star" style="color: var(--warn);"></i></span>
                  <div style="flex: 1; background: var(--panel2); border-radius: 4px; height: 20px; overflow: hidden;">
                    <div id="rating1Bar"
                      style="height: 100%; background: linear-gradient(90deg, var(--danger), #f87171); width: 0%; transition: width 0.5s;">
                    </div>
                  </div>
                  <span id="rating1Count" style="width: 40px; text-align: right;">0</span>
                </div>
              </div>
            </div>

            <!-- Agent Leaderboard (Admin only) -->
            <div id="agentLeaderboardPanel" class="panel" style="margin-top: 16px; display: none;">
              <div class="panelHead"><b><i class="fa-solid fa-trophy"></i> Agent Topplista</b></div>
              <div id="agentLeaderboardList" class="list" style="margin-top: 15px;"></div>
            </div>
          </div>

          <!-- Right Panel: Feedback List -->
          <div class="panel">
            <div class="panelHead">
              <b><i class="fa-solid fa-list"></i> Feedback</b>
              <span id="fbListCount" class="pill muted" style="margin-left: 10px;">0</span>
            </div>
            <div id="feedbackListContainer" class="list" style="max-height: 600px; overflow-y: auto; margin-top: 15px;">
              <div class="muted center" style="padding: 40px;">
                <i class="fa-solid fa-inbox"
                  style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                Ingen feedback √§nnu
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SCENARIOPLANERING - Business Focused -->
      <section id="scenarioView" class="view" style="display:none;">

        <!-- HEADER -->
        <div class="topbar">
          <div>
            <div class="title"><i class="fa-solid fa-briefcase" style="color:var(--primary);"></i> Aff√§rsanalys</div>
            <div class="subtitle muted">Kapacitetsplanering och kostnadsoptimering</div>
          </div>
          <div class="topbarActions">
            <button id="scenarioExportBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-download"></i> Exportera
            </button>
          </div>
        </div>

        <!-- MAIN CONTENT -->
        <!-- MAIN CONTENT -->
        <div class="scenarioContent">

          <!-- VIEW MODE SELECTOR & SUMMARY -->
          <div class="scenarioHeaderPanel">
            <div class="headerTopRow"
              style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
              <h2 style="margin:0; font-size:20px;">Scenario & Prognos</h2>
              <div class="scenarioTimeFilter">
                <span class="filterLabel">Prognosperiod:</span>
                <div class="segmentedControl">
                  <button class="timeFilterBtn" onclick="setScenarioTime(1)" id="tf_1">1 M√•n</button>
                  <button class="timeFilterBtn active" onclick="setScenarioTime(12)" id="tf_12">1 √Ör</button>
                  <button class="timeFilterBtn" onclick="setScenarioTime(36)" id="tf_36">3 √Ör</button>
                </div>
              </div>
            </div>

            <!-- Sticky Summary with Dynamic Time -->
            <div class="scenarioSummaryBar">
              <div class="summaryStats">
                <div class="summaryStat primary">
                  <span class="label" id="summary_save_label">Besparing (1 √•r)</span>
                  <span class="value positive giant" id="sc_summaryYearSave">810 000 kr</span>
                </div>
                <div class="summaryStat warning">
                  <span class="label" id="summary_time_label">Sparad Tid</span>
                  <span class="value" id="sc_summaryTime">4 000 h</span>
                </div>
                <div class="summaryStat ok">
                  <span class="label">ROI</span>
                  <span class="value positive" id="sc_summaryRoi">340%</span>
                </div>
              </div>
              <div class="topbarActions">
                <button class="btn ghost small" onclick="toggleScenarioOnboarding()">
                  <i class="fa-solid fa-circle-question"></i> Hj√§lp
                </button>
                <button class="btn ghost small" onclick="exportScenarioReport()">
                  <i class="fa-solid fa-download"></i> Rapport
                </button>
              </div>
            </div>

            <!-- Mode Tabs -->
            <div class="scenarioModeTabs">
              <button class="modeTab active" onclick="setScenarioMode('overview')" id="tab_overview">
                <i class="fa-solid fa-chart-pie"></i> √ñversikt
              </button>
              <button class="modeTab" onclick="setScenarioMode('optimization')" id="tab_optimization">
                <i class="fa-solid fa-rocket"></i> Optimering
              </button>
              <button class="modeTab" onclick="setScenarioMode('strategy')" id="tab_strategy">
                <i class="fa-solid fa-chess"></i> Strategi
              </button>
              <button class="modeTab" onclick="setScenarioMode('myView')" id="tab_myView">
                <i class="fa-solid fa-star"></i> Min Vy
              </button>
            </div>
          </div>

          <!-- ONBOARDING MODAL -->
          <div id="scenarioOnboarding" class="onboardingModal" style="display:none;">
            <div class="onboardingContent">
              <div class="step" data-step="1">
                <div class="stepIcon"><i class="fa-solid fa-sliders"></i></div>
                <h3>1. Justera antaganden</h3>
                <p>St√§ll in reglagen f√∂r att matcha din verksamhet.</p>
              </div>
              <div class="step" data-step="2">
                <div class="stepIcon"><i class="fa-solid fa-clock"></i></div>
                <h3>2. V√§lj tidsperiod</h3>
                <p>Anv√§nd filtret "1 M√•n / 1 √Ör / 3 √Ör" f√∂r att se l√•ngsiktig effekt.</p>
              </div>
              <div class="step" data-step="3">
                <div class="stepIcon"><i class="fa-solid fa-star"></i></div>
                <h3>3. Spara favoriter</h3>
                <p>Stj√§rnmarkera dina viktigaste nyckeltal till "Min Vy".</p>
              </div>
              <button class="btn primary full" onclick="closeScenarioOnboarding()">Jag f√∂rst√•r, k√∂r ig√•ng!</button>
            </div>
          </div>

          <!-- MY VIEW (Favorites) -->
          <div id="sc_mode_myView" class="scenarioModeSection" style="display:none;">
            <div class="sectionHeader">
              <h3><i class="fa-solid fa-star"></i> Min Dashboard</h3>
              <span class="sectionSubtitle">Dina utvalda m√§tv√§rden</span>
            </div>
            <div id="sc_favoritesContainer" class="favoritesGrid">
              <div class="emptyState">
                <i class="fa-regular fa-star"></i>
                <p>Du har inte valt n√•gra favoriter √§n.</p>
              </div>
            </div>
          </div>

          <!-- OVERVIEW MODE -->
          <div id="sc_mode_overview" class="scenarioModeSection">

            <!-- HERO METRICS GRID -->
            <div class="heroMetricsGrid">
              <!-- Card 1: MONEY -->
              <div class="heroCard money">
                <button class="favoriteBtn" onclick="toggleFavorite('sc_yearSavings', 'Total Besparing')"><i
                    class="fa-regular fa-star"></i></button>
                <div class="heroIcon"><i class="fa-solid fa-sack-dollar"></i></div>
                <div class="heroLabel" id="hero_money_label">Besparing (1 √•r)</div>
                <div class="heroValue" id="hero_money_val">810 000 kr</div>
                <div class="heroSub" id="hero_money_sub">Minskad driftskostnad</div>
              </div>

              <!-- Card 2: TIME -->
              <div class="heroCard time">
                <button class="favoriteBtn" onclick="toggleFavorite('sc_hoursSaved', 'Sparad Tid')"><i
                    class="fa-regular fa-star"></i></button>
                <div class="heroIcon"><i class="fa-solid fa-clock"></i></div>
                <div class="heroLabel" id="hero_time_label">Sparad Tid (1 √•r)</div>
                <div class="heroValue" id="hero_time_val">4 000 h</div>
                <div class="heroSub" id="hero_time_sub">Motsvarar <span id="hero_fte_val">2.5</span> heltidstj√§nster
                </div>
              </div>

              <!-- Card 3: VOLUME -->
              <div class="heroCard vol">
                <button class="favoriteBtn" onclick="toggleFavorite('sc_aiTickets', 'AI-√§renden')"><i
                    class="fa-regular fa-star"></i></button>
                <div class="heroIcon"><i class="fa-solid fa-robot"></i></div>
                <div class="heroLabel" id="hero_vol_label">AI-hanterade √§renden</div>
                <div class="heroValue" id="hero_vol_val">2 400</div>
                <div class="heroSub">Automatiserade √§renden</div>
              </div>

              <!-- Card 4: QUALITY -->
              <div class="heroCard quality">
                <button class="favoriteBtn" onclick="toggleFavorite('sc_currentSla', 'Servicekvalitet')"><i
                    class="fa-regular fa-star"></i></button>
                <div class="heroIcon"><i class="fa-solid fa-heart"></i></div>
                <div class="heroLabel">Servicekvalitet</div>
                <div class="heroValue" id="sc_currentSla">92%</div>
                <div class="heroSub active">Uppn√•r SLA-m√•l</div>
              </div>
            </div>

            <!-- SEKTION 2: AFF√ÑRSANTAGANDEN (Simplified) -->
            <div id="sc_assumptions" class="scenarioSection assumptions">
              <div class="sectionHeader togglable" onclick="toggleSection('sc_assumptions_content')">
                <h3><i class="fa-solid fa-sliders"></i> Justera simulering</h3>
                <span class="sectionSubtitle">Dra i reglagen f√∂r att se effekten direkt</span>
                <i class="fa-solid fa-chevron-down toggleIcon"></i>
              </div>
              <div id="sc_assumptions_content" class="sectionContent">
                <div class="assumptionsGrid">
                  <div class="assumptionCard">
                    <div class="assumptionQuestion">√Ñrenden / m√•nad</div>
                    <div class="assumptionInput">
                      <input type="range" id="sc_tickets" class="slider" min="100" max="5000" value="500" step="50">
                      <div class="sliderValue"><span id="sc_tickets_val">500</span> st</div>
                    </div>
                  </div>
                  <div class="assumptionCard">
                    <div class="assumptionQuestion">AI-grad (%)</div>
                    <div class="assumptionInput">
                      <input type="range" id="sc_aiRate" class="slider" min="0" max="95" value="40" step="5">
                      <div class="sliderValue"><span id="sc_aiRate_val">40</span>%</div>
                    </div>
                  </div>
                  <div class="assumptionCard">
                    <div class="assumptionQuestion">Personalkostnad / m√•n</div>
                    <div class="assumptionInput">
                      <input type="range" id="sc_staffCost" class="slider" min="25000" max="80000" value="45000"
                        step="1000">
                      <div class="sliderValue"><span id="sc_staffCost_val">45 000</span> kr</div>
                    </div>
                  </div>

                  <div class="advancedAssumptionsToggle"
                    onclick="document.getElementById('advancedAssumptions').classList.toggle('hidden')">
                    <i class="fa-solid fa-cog"></i> Visa fler inst√§llningar
                  </div>
                  <div id="advancedAssumptions" class="hidden">
                    <div class="assumptionCard">
                      <div class="assumptionQuestion">√Ñrenden per handl√§ggare / dag</div>
                      <div class="assumptionInput">
                        <input type="range" id="sc_ticketsPerDay" class="slider" min="5" max="50" value="12" step="1">
                        <div class="sliderValue"><span id="sc_ticketsPerDay_val">12</span> st</div>
                      </div>
                    </div>
                    <div class="assumptionCard">
                      <div class="assumptionQuestion">M√•l f√∂r Service Level (SLA)</div>
                      <div class="assumptionInput">
                        <input type="range" id="sc_targetSla" class="slider" min="80" max="99" value="90" step="1">
                        <div class="sliderValue"><span id="sc_targetSla_val">90</span>%</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- SEKTION 7: REKOMMENDATION (Action Oriented) -->
            <div id="sc_rec" class="scenarioSection recommendation">
              <div class="recommendationCard" id="sc_recommendation">
                <div class="recIcon"><i class="fa-solid fa-check-double"></i></div>
                <div class="recContent">
                  <div class="recTitle">Rekommendation</div>
                  <div class="recText" id="sc_recText">
                    Analysera...
                  </div>
                  <!-- Hidden hidden inputs for calculation reference -->
                  <div style="display:none">
                    <span id="sc_yearSavings"></span>
                    <span id="sc_hoursSaved"></span>
                    <span id="sc_aiTickets"></span>
                    <span id="sc_currentCost"></span>
                  </div>
                </div>
              </div>
            </div>
          </div> <!-- OPTIMIZATION MODE -->
          <div id="sc_mode_optimization" class="scenarioModeSection" style="display:none;">
            <div class="topInsight">
              <i class="fa-solid fa-arrow-trend-up"></i>
              <span id="sc_topInsight_opt">√ñkad automatisering kan frig√∂ra 1.5 √•rsarbetare (+340% ROI).</span>
            </div>

            <!-- SEKTION 6: TIDSBESPARING -->
            <div id="sc_time" class="scenarioSection time">
              <div class="sectionHeader togglable" onclick="toggleSection('sc_time_content')">
                <h3><i class="fa-solid fa-hourglass-half"></i> Tidseffektivitet</h3>
                <span class="sectionSubtitle">Frigjord tid f√∂r v√§rdeskapande arbete</span>
                <i class="fa-solid fa-chevron-down toggleIcon"></i>
              </div>
              <div id="sc_time_content" class="sectionContent">
                <div class="timeGrid">
                  <div class="timeStat">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_hoursWeek', 'Timmar/vecka')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="timeValue" id="sc_hoursWeek">75 h</div>
                    <div class="timeLabel">Per vecka</div>
                  </div>
                  <div class="timeStat">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_hoursMonth', 'Timmar/m√•nad')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="timeValue" id="sc_hoursMonth">333 h</div>
                    <div class="timeLabel">Per m√•nad</div>
                  </div>
                  <div class="timeStat">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_hoursYear', 'Timmar/√•r')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="timeValue" id="sc_hoursYear">4 000 h</div>
                    <div class="timeLabel">Per √•r</div>
                  </div>
                  <div class="timeStat highlight">
                    <div class="timeValue">2.4</div>
                    <div class="timeLabel">√Örsarbetare (FTE)</div>
                    <div class="actionLink">‚Üí Omf√∂rdela resurser</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- SEKTION 3: AFF√ÑRSEFFEKT -->
            <div id="sc_results" class="scenarioSection results">
              <div class="sectionHeader togglable" onclick="toggleSection('sc_results_content')">
                <h3><i class="fa-solid fa-chart-line"></i> Aff√§rseffekt</h3>
                <span class="sectionSubtitle">Resultat av nuvarande inst√§llningar</span>
                <i class="fa-solid fa-chevron-down toggleIcon"></i>
              </div>
              <div id="sc_results_content" class="sectionContent">
                <div class="resultsGrid">
                  <div class="resultCard primary">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_reqStaff', 'Bemanning')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="resultIcon"><i class="fa-solid fa-users"></i></div>
                    <div class="resultContent">
                      <div class="resultValue" id="sc_reqStaff">3</div>
                      <div class="resultLabel">Bemanning <i class="fa-solid fa-circle-info tooltip"
                          title="Antal heltidstj√§nster som kr√§vs"></i></div>
                      <div class="resultRecommendation" id="sc_staffCtx">Optimal niv√•</div>
                    </div>
                  </div>
                  <div class="resultCard status-ok">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_savings', 'Besparing')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="resultIcon"><i class="fa-solid fa-piggy-bank"></i></div>
                    <div class="resultContent">
                      <div class="resultValue" id="sc_savings">45 000 kr</div>
                      <div class="resultLabel">Besparing <i class="fa-solid fa-circle-info tooltip"
                          title="Minskad kostnad vs manuell hantering"></i></div>
                      <div class="resultRecommendation">Investera i tillv√§xt</div>
                    </div>
                  </div>
                  <div class="resultCard">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_projectedSla', 'F√∂rv√§ntad SLA')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="resultIcon"><i class="fa-solid fa-gauge-high"></i></div>
                    <div class="resultContent">
                      <div class="resultValue" id="sc_projectedSla">94%</div>
                      <div class="resultLabel">SLA-prognos <i class="fa-solid fa-circle-info tooltip"
                          title="Ber√§knad servicekvalitet givet kapacitet"></i></div>
                      <div class="resultRecommendation">√ñver m√•let (90%)</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- STRATEGY MODE -->
          <div id="sc_mode_strategy" class="scenarioModeSection" style="display:none;">
            <div class="topInsight">
              <i class="fa-solid fa-chess"></i>
              <span id="sc_topInsight_strat">Break-even vid 750 √§renden. Nuvarande kostnad per √§rende (270 kr) √§r
                konkurrenskraftig.</span>
            </div>

            <!-- SEKTION 4: BESPARINGS√ñVERSIKT -->
            <div id="sc_savings" class="scenarioSection savings">
              <div class="sectionHeader togglable" onclick="toggleSection('sc_savings_content')">
                <h3><i class="fa-solid fa-piggy-bank"></i> Finansiell Analys</h3>
                <span class="sectionSubtitle">ROI och l√•ngsiktig l√∂nsamhet</span>
                <i class="fa-solid fa-chevron-down toggleIcon"></i>
              </div>
              <div id="sc_savings_content" class="sectionContent">
                <div class="savingsGrid">
                  <div class="savingsCard highlight">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_yearSavings', '√Örsbesparing')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="savingsIcon"><i class="fa-solid fa-calendar-check"></i></div>
                    <div class="savingsValue" id="sc_yearSavings">810 000 kr</div>
                    <div class="savingsLabel">√Örlig besparing (Netto)</div>
                  </div>
                  <div class="savingsCard">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_roiPercent', 'ROI')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="savingsIcon"><i class="fa-solid fa-percent"></i></div>
                    <div class="savingsValue" id="sc_roiPercent">340%</div>
                    <div class="savingsLabel">ROI (3-√•rs prognos)</div>
                  </div>
                  <div class="savingsCard">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_costPerTicket', 'Kostnad/√§rende')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="savingsIcon"><i class="fa-solid fa-tag"></i></div>
                    <div class="savingsValue" id="sc_costPerTicket">270 kr</div>
                    <div class="savingsLabel">Kostnad per √§rende</div>
                    <div class="savingsContext success">22% l√§gre √§n snitt</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- SEKTION 5: TILLV√ÑXT & SKALBARHET -->
            <div id="sc_growth" class="scenarioSection growth">
              <div class="sectionHeader togglable" onclick="toggleSection('sc_growth_content')">
                <h3><i class="fa-solid fa-chart-line"></i> Skalbarhet</h3>
                <span class="sectionSubtitle">Kapacitetsplanering f√∂r tillv√§xt</span>
                <i class="fa-solid fa-chevron-down toggleIcon"></i>
              </div>
              <div id="sc_growth_content" class="sectionContent">
                <div class="growthGrid">
                  <div class="growthCard full-width">
                    <div class="growthLabel" style="display:flex; justify-content:space-between;">
                      <span>Kapacitetsutnyttjande</span>
                      <span id="sc_capacityPercent">75%</span>
                    </div>
                    <div class="growthBar large">
                      <div class="growthProgress" id="sc_capacityBar" style="width: 75%"></div>
                    </div>
                    <div class="growthContext">Du har utrymme f√∂r att v√§xa utan att √∂ka kostnaderna.</div>
                  </div>

                  <div class="growthCard">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_maxTickets', 'Maxkapacitet')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="growthLabel">Maxkapacitet</div>
                    <div class="growthValue large" id="sc_maxTickets">660</div>
                    <div class="growthContext">√Ñrenden/m√•n</div>
                  </div>
                  <div class="growthCard">
                    <button class="favoriteBtn" onclick="toggleFavorite('sc_breakeven', 'Break-even')"><i
                        class="fa-regular fa-star"></i></button>
                    <div class="growthLabel">Break-even punkt</div>
                    <div class="growthValue" id="sc_breakeven">750</div>
                    <div class="growthContext">Kritisk gr√§ns</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
      </section>
      <!-- SALES ANALYTICS - REDESIGNED -->
      <section id="salesView" class="view" style="display:none;">

        <!-- ONBOARDING MODAL -->
        <div id="salesOnboarding" class="salesOnboardingModal" style="display:none;">
          <div class="salesOnboardingContent">
            <button class="modalClose" onclick="closeSalesOnboarding()">&times;</button>
            <h2 style="margin-bottom: 20px;"><i class="fa-solid fa-rocket" style="color: var(--primary);"></i> V√§lkommen
              till S√§ljanalys</h2>
            <div class="onboardingSteps">
              <div class="onboardingStep">
                <div class="stepNumber">1</div>
                <div class="stepContent">
                  <h4>V√§lj ditt l√§ge</h4>
                  <p>B√∂rja med <b>√ñversikt</b> f√∂r snabb statusbild. G√• till <b>Optimering</b> f√∂r
                    f√∂rb√§ttringsarbete eller <b>Strategi</b> f√∂r l√•ngsiktig planering.</p>
                </div>
              </div>
              <div class="onboardingStep">
                <div class="stepNumber">2</div>
                <div class="stepContent">
                  <h4>Fokusera p√• gr√∂na och r√∂da signaler</h4>
                  <p>Gr√∂nt = bra, r√∂tt = kr√§ver √•tg√§rd. F√∂lj rekommendationerna som visas automatiskt.</p>
                </div>
              </div>
              <div class="onboardingStep">
                <div class="stepNumber">3</div>
                <div class="stepContent">
                  <h4>Skapa din personliga vy</h4>
                  <p>Klicka p√• <i class="fa-regular fa-star"></i> f√∂r att markera favoriter och bygg din egen
                    dashboard.</p>
                </div>
              </div>
            </div>
            <button class="btn primary" onclick="closeSalesOnboarding()" style="margin-top: 20px;">
              <i class="fa-solid fa-check"></i> Jag f√∂rst√•r, starta
            </button>
          </div>
        </div>

        <!-- HEADER -->
        <div class="topbar">
          <div>
            <div class="title"><i class="fa-solid fa-chart-column" style="color:var(--ok);"></i> S√§ljanalys</div>
            <div class="subtitle muted">Fatta snabba, datadrivna beslut</div>
          </div>
          <div class="topbarActions">
            <select id="salesPeriodFilter" class="input" style="width: auto;">
              <option value="7">7 dagar</option>
              <option value="30" selected>30 dagar</option>
              <option value="90">90 dagar</option>
              <option value="365">1 √•r</option>
            </select>
            <button id="showSalesOnboarding" class="btn ghost" type="button" title="Visa guide">
              <i class="fa-solid fa-circle-question"></i>
            </button>
            <button id="exportSalesBtn" class="btn ghost" type="button">
              <i class="fa-solid fa-download"></i>
            </button>
          </div>
        </div>

        <!-- VIEW MODE SELECTOR -->
        <div class="salesModeSelector">
          <button class="salesModeBtn active" data-mode="overview"
            title="Snabb statusbild med de viktigaste nyckeltalen">
            <i class="fa-solid fa-gauge"></i>
            <span>√ñversikt</span>
            <small>Nyckeltal</small>
          </button>
          <button class="salesModeBtn" data-mode="optimization" title="Optimera konvertering, AI och mers√§lj">
            <i class="fa-solid fa-sliders"></i>
            <span>Optimering</span>
            <small>F√∂rb√§ttra</small>
          </button>
          <button class="salesModeBtn" data-mode="strategy"
            title="L√•ngsiktig planering med CLV, churn och prediktioner">
            <i class="fa-solid fa-chess"></i>
            <span>Strategi</span>
            <small>Planera</small>
          </button>
          <button class="salesModeBtn" data-mode="myview" title="Dina favoritmarkerade m√§tv√§rden">
            <i class="fa-solid fa-star"></i>
            <span>Min vy</span>
            <small>Favoriter</small>
          </button>
        </div>

        <!-- ==================== OVERVIEW MODE ==================== -->
        <div id="salesModeOverview" class="salesModeContent">

          <!-- TOP INSIGHT -->
          <div class="topInsightCard" id="overviewTopInsight">
            <div class="insightIcon"><i class="fa-solid fa-lightbulb"></i></div>
            <div class="insightContent">
              <div class="insightTitle">Laddar insikt...</div>
              <div class="insightText">Analyserar din f√∂rs√§ljningsdata</div>
            </div>
          </div>

          <!-- PRIMARY KPIs -->
          <div class="salesPrimaryKpis">
            <div class="primaryKpiCard" data-kpi="revenue">
              <button class="favoriteBtn" onclick="toggleFavorite('revenue')" title="Markera som favorit"><i
                  class="fa-regular fa-star"></i></button>
              <div class="kpiValue" id="kpi_revenue">0 kr</div>
              <div class="kpiLabel">Total f√∂rs√§ljning <span class="kpiTooltip"
                  title="Summan av alla genomf√∂rda k√∂p under vald period"><i class="fa-solid fa-circle-info"></i></span>
              </div>
              <div class="kpiTrend" id="kpi_revenue_trend"></div>
            </div>
            <div class="primaryKpiCard" data-kpi="conversion">
              <button class="favoriteBtn" onclick="toggleFavorite('conversion')" title="Markera som favorit"><i
                  class="fa-regular fa-star"></i></button>
              <div class="kpiValue" id="kpi_conversion">0%</div>
              <div class="kpiLabel">Konverteringsgrad <span class="kpiTooltip"
                  title="Andel bes√∂kare som genomf√∂r k√∂p"><i class="fa-solid fa-circle-info"></i></span></div>
              <div class="kpiTrend" id="kpi_conversion_trend"></div>
            </div>
            <div class="primaryKpiCard" data-kpi="aov">
              <button class="favoriteBtn" onclick="toggleFavorite('aov')" title="Markera som favorit"><i
                  class="fa-regular fa-star"></i></button>
              <div class="kpiValue" id="kpi_aov">0 kr</div>
              <div class="kpiLabel">Orderv√§rde (snitt) <span class="kpiTooltip"
                  title="Genomsnittligt belopp per order"><i class="fa-solid fa-circle-info"></i></span></div>
              <div class="kpiTrend" id="kpi_aov_trend"></div>
            </div>
            <div class="primaryKpiCard" data-kpi="aiRevenue">
              <button class="favoriteBtn" onclick="toggleFavorite('aiRevenue')" title="Markera som favorit"><i
                  class="fa-regular fa-star"></i></button>
              <div class="kpiValue" id="kpi_aiRevenue">0 kr</div>
              <div class="kpiLabel">AI-driven f√∂rs√§ljning <span class="kpiTooltip"
                  title="Int√§kter fr√•n k√∂p d√§r AI var involverad"><i class="fa-solid fa-circle-info"></i></span>
              </div>
              <div class="kpiTrend" id="kpi_aiRevenue_trend"></div>
            </div>
            <div class="primaryKpiCard" data-kpi="orders">
              <button class="favoriteBtn" onclick="toggleFavorite('orders')" title="Markera som favorit"><i
                  class="fa-regular fa-star"></i></button>
              <div class="kpiValue" id="kpi_orders">0</div>
              <div class="kpiLabel">Antal k√∂p <span class="kpiTooltip" title="Totalt antal genomf√∂rda ordrar"><i
                    class="fa-solid fa-circle-info"></i></span></div>
              <div class="kpiTrend" id="kpi_orders_trend"></div>
            </div>
          </div>

          <!-- ACTION RECOMMENDATIONS -->
          <div class="actionRecommendations" id="overviewActions"></div>
        </div>

        <!-- ==================== OPTIMIZATION MODE ==================== -->
        <div id="salesModeOptimization" class="salesModeContent" style="display:none;">

          <!-- Sales Flow Section -->
          <div class="salesSection">
            <div class="salesSectionHeader" onclick="toggleSalesSection('salesFlow')">
              <div class="sectionTitle"><i class="fa-solid fa-filter"></i> <span>F√∂rs√§ljningsfl√∂de</span> <span
                  class="sectionInsight" id="salesFlowInsight"></span></div>
              <i class="fa-solid fa-chevron-down sectionChevron"></i>
            </div>
            <div class="salesSectionContent" id="salesFlowContent">
              <div class="secondaryKpiGrid">
                <div class="secondaryKpiCard" data-kpi="convStarted">
                  <button class="favoriteBtn" onclick="toggleFavorite('convStarted')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Startade konversationer <i class="fa-solid fa-circle-info kpiInfo"
                      title="Antal chattar som initierats"></i></div>
                  <div class="skpiValue" id="kpi_convStarted">-</div>
                </div>
                <div class="secondaryKpiCard" data-kpi="offersShown">
                  <button class="favoriteBtn" onclick="toggleFavorite('offersShown')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Erbjudanden visade <i class="fa-solid fa-circle-info kpiInfo"
                      title="Antal s√§ljf√∂rslag som presenterats"></i></div>
                  <div class="skpiValue" id="kpi_offersShown">-</div>
                </div>
                <div class="secondaryKpiCard" data-kpi="offersClicked">
                  <button class="favoriteBtn" onclick="toggleFavorite('offersClicked')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Klick p√• erbjudanden <i class="fa-solid fa-circle-info kpiInfo"
                      title="Antal g√•nger kunder klickade p√• f√∂rslag"></i></div>
                  <div class="skpiValue" id="kpi_offersClicked">-</div>
                </div>
                <div class="secondaryKpiCard status-warn" data-kpi="dropoff">
                  <button class="favoriteBtn" onclick="toggleFavorite('dropoff')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Drop-off <i class="fa-solid fa-circle-info kpiInfo"
                      title="Andel som avbr√∂t innan k√∂p"></i></div>
                  <div class="skpiValue" id="kpi_dropoff">-</div>
                  <div class="skpiAction" id="kpi_dropoff_action"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Upsell Section -->
          <div class="salesSection">
            <div class="salesSectionHeader" onclick="toggleSalesSection('upsell')">
              <div class="sectionTitle"><i class="fa-solid fa-arrow-up-right-dots"></i> <span>Mers√§lj &
                  Korsf√∂rs√§ljning</span> <span class="sectionInsight" id="upsellInsight"></span></div>
              <i class="fa-solid fa-chevron-down sectionChevron"></i>
            </div>
            <div class="salesSectionContent" id="upsellContent">
              <div class="secondaryKpiGrid">
                <div class="secondaryKpiCard" data-kpi="upsellRate">
                  <button class="favoriteBtn" onclick="toggleFavorite('upsellRate')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Mers√§ljsgrad <i class="fa-solid fa-circle-info kpiInfo"
                      title="Andel ordrar med till√§ggsprodukter"></i></div>
                  <div class="skpiValue" id="kpi_upsellRate">-</div>
                </div>
                <div class="secondaryKpiCard" data-kpi="upsellRevenue">
                  <button class="favoriteBtn" onclick="toggleFavorite('upsellRevenue')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Mers√§ljsint√§kt <i class="fa-solid fa-circle-info kpiInfo"
                      title="Extra int√§kt fr√•n till√§ggsprodukter"></i></div>
                  <div class="skpiValue" id="kpi_upsellRevenue">-</div>
                </div>
                <div class="secondaryKpiCard status-warn" data-kpi="rejectedOffers">
                  <button class="favoriteBtn" onclick="toggleFavorite('rejectedOffers')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Avvisade f√∂rslag <i class="fa-solid fa-circle-info kpiInfo"
                      title="Andel erbjudanden som nekades"></i></div>
                  <div class="skpiValue" id="kpi_rejectedOffers">-</div>
                  <div class="skpiAction" id="kpi_rejectedOffers_action"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- AI as Salesperson Section -->
          <div class="salesSection">
            <div class="salesSectionHeader" onclick="toggleSalesSection('aiSeller')">
              <div class="sectionTitle"><i class="fa-solid fa-robot"></i> <span>AI som s√§ljare</span> <span
                  class="sectionInsight" id="aiSellerInsight"></span></div>
              <i class="fa-solid fa-chevron-down sectionChevron"></i>
            </div>
            <div class="salesSectionContent" id="aiSellerContent">
              <div class="secondaryKpiGrid">
                <div class="secondaryKpiCard" data-kpi="aiConversion">
                  <button class="favoriteBtn" onclick="toggleFavorite('aiConversion')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">AI-konvertering <i class="fa-solid fa-circle-info kpiInfo"
                      title="Andel AI-f√∂rslag som ledde till k√∂p"></i></div>
                  <div class="skpiValue" id="kpi_aiConversion">-</div>
                </div>
                <div class="secondaryKpiCard" data-kpi="promptPerformance">
                  <button class="favoriteBtn" onclick="toggleFavorite('promptPerformance')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">B√§sta prompt <i class="fa-solid fa-circle-info kpiInfo"
                      title="Promptversion med h√∂gst konvertering"></i></div>
                  <div class="skpiValue" id="kpi_promptPerformance">-</div>
                </div>
                <div class="secondaryKpiCard status-danger" data-kpi="fallbackLost">
                  <button class="favoriteBtn" onclick="toggleFavorite('fallbackLost')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Tappad vid eskalering <i class="fa-solid fa-circle-info kpiInfo"
                      title="F√∂rlorad int√§kt n√§r AI eskalerade"></i></div>
                  <div class="skpiValue" id="kpi_fallbackLost">-</div>
                  <div class="skpiAction" id="kpi_fallbackLost_action"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== STRATEGY MODE ==================== -->
        <div id="salesModeStrategy" class="salesModeContent" style="display:none;">

          <!-- CLV Section -->
          <div class="salesSection">
            <div class="salesSectionHeader" onclick="toggleSalesSection('clv')">
              <div class="sectionTitle"><i class="fa-solid fa-gem"></i> <span>Kundlivstidsv√§rde (CLV)</span> <span
                  class="sectionInsight" id="clvInsight"></span></div>
              <i class="fa-solid fa-chevron-down sectionChevron"></i>
            </div>
            <div class="salesSectionContent" id="clvContent">
              <div class="secondaryKpiGrid">
                <div class="secondaryKpiCard status-ok" data-kpi="clvTotal">
                  <button class="favoriteBtn" onclick="toggleFavorite('clvTotal')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Genomsnittligt CLV <i class="fa-solid fa-circle-info kpiInfo"
                      title="F√∂rv√§ntat livstidsv√§rde per kund"></i></div>
                  <div class="skpiValue" id="kpi_clvTotal">-</div>
                </div>
                <div class="secondaryKpiCard status-ok" data-kpi="clvAi">
                  <button class="favoriteBtn" onclick="toggleFavorite('clvAi')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">CLV med AI <i class="fa-solid fa-circle-info kpiInfo"
                      title="CLV f√∂r kunder som interagerat med AI"></i></div>
                  <div class="skpiValue" id="kpi_clvAi">-</div>
                </div>
                <div class="secondaryKpiCard" data-kpi="clvGrowth">
                  <button class="favoriteBtn" onclick="toggleFavorite('clvGrowth')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">CLV-tillv√§xt <i class="fa-solid fa-circle-info kpiInfo"
                      title="F√∂r√§ndring av CLV √∂ver tid"></i></div>
                  <div class="skpiValue" id="kpi_clvGrowth">-</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Churn Section -->
          <div class="salesSection">
            <div class="salesSectionHeader" onclick="toggleSalesSection('churn')">
              <div class="sectionTitle"><i class="fa-solid fa-user-slash"></i> <span>Kundbortfall (Churn)</span> <span
                  class="sectionInsight status-warn" id="churnInsight"></span></div>
              <i class="fa-solid fa-chevron-down sectionChevron"></i>
            </div>
            <div class="salesSectionContent" id="churnContent">
              <div class="secondaryKpiGrid">
                <div class="secondaryKpiCard status-warn" data-kpi="churnRisk">
                  <button class="favoriteBtn" onclick="toggleFavorite('churnRisk')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Genomsnittlig churn-risk <i class="fa-solid fa-circle-info kpiInfo"
                      title="Andel kunder med h√∂g avhoppsrisk"></i></div>
                  <div class="skpiValue" id="kpi_churnRisk">-</div>
                  <div class="skpiAction" id="kpi_churnRisk_action"></div>
                </div>
                <div class="secondaryKpiCard status-danger" data-kpi="churnFailedAi">
                  <button class="favoriteBtn" onclick="toggleFavorite('churnFailedAi')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Churn efter AI-misslyckande <i class="fa-solid fa-circle-info kpiInfo"
                      title="Avhopp efter d√•lig AI-upplevelse"></i></div>
                  <div class="skpiValue" id="kpi_churnFailedAi">-</div>
                  <div class="skpiAction" id="kpi_churnFailedAi_action"></div>
                </div>
                <div class="secondaryKpiCard" data-kpi="highRiskCount">
                  <button class="favoriteBtn" onclick="toggleFavorite('highRiskCount')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">H√∂grisk-kunder <i class="fa-solid fa-circle-info kpiInfo"
                      title="Antal kunder med >70% churn-risk"></i></div>
                  <div class="skpiValue" id="kpi_highRiskCount">-</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Predictive Section -->
          <div class="salesSection">
            <div class="salesSectionHeader" onclick="toggleSalesSection('predictive')">
              <div class="sectionTitle"><i class="fa-solid fa-crystal-ball"></i> <span>Prediktiv analys</span> <span
                  class="sectionInsight" id="predictiveInsight"></span></div>
              <i class="fa-solid fa-chevron-down sectionChevron"></i>
            </div>
            <div class="salesSectionContent" id="predictiveContent">
              <div class="secondaryKpiGrid">
                <div class="secondaryKpiCard" data-kpi="predictedRevenue">
                  <button class="favoriteBtn" onclick="toggleFavorite('predictedRevenue')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Prognostiserad int√§kt <i class="fa-solid fa-circle-info kpiInfo"
                      title="F√∂rv√§ntad f√∂rs√§ljning n√§sta period"></i></div>
                  <div class="skpiValue" id="kpi_predictedRevenue">-</div>
                </div>
                <div class="secondaryKpiCard status-ok" data-kpi="hotLeads">
                  <button class="favoriteBtn" onclick="toggleFavorite('hotLeads')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">Heta leads <i class="fa-solid fa-circle-info kpiInfo"
                      title="Kunder med >80% k√∂psannolikhet"></i></div>
                  <div class="skpiValue" id="kpi_hotLeads">-</div>
                </div>
                <div class="secondaryKpiCard" data-kpi="buyProbability">
                  <button class="favoriteBtn" onclick="toggleFavorite('buyProbability')"><i
                      class="fa-regular fa-star"></i></button>
                  <div class="skpiLabel">K√∂psannolikhet (snitt) <i class="fa-solid fa-circle-info kpiInfo"
                      title="Genomsnittlig sannolikhet f√∂r k√∂p"></i></div>
                  <div class="skpiValue" id="kpi_buyProbability">-</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ==================== MY VIEW MODE ==================== -->
        <div id="salesModeMyview" class="salesModeContent" style="display:none;">
          <div class="myViewContainer">
            <div class="myViewHeader">
              <h3><i class="fa-solid fa-star" style="color: var(--warn);"></i> Mina favoriter</h3>
              <p class="muted">Klicka p√• <i class="fa-regular fa-star"></i> bredvid valfritt m√§tv√§rde f√∂r att l√§gga
                till det h√§r.</p>
            </div>
            <div class="myViewKpis" id="myViewKpiContainer">
              <div class="myViewEmpty" id="myViewEmpty">
                <i class="fa-regular fa-star" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px;"></i>
                <p>Du har inga favoriter √§nnu</p>
                <p class="muted">G√• till √ñversikt, Optimering eller Strategi och markera de m√§tv√§rden du vill se
                  h√§r.</p>
              </div>
            </div>
          </div>
        </div>

      </section>

    </main>
  </div>

  <!-- CUSTOMER FEEDBACK MODAL -->
  <div id="feedbackModal" class="modal" style="display: none;">
    <div class="modalContent" style="max-width: 400px; text-align: center;">
      <div class="modalHeader">
        <h3><i class="fa-solid fa-star" style="color: var(--warn);"></i> Hur var din upplevelse?</h3>
        <button class="modalClose" onclick="closeFeedbackModal()">&times;</button>
      </div>
      <div class="modalBody" style="padding: 25px;">
        <p class="muted" style="margin-bottom: 20px;">Din feedback hj√§lper oss att f√∂rb√§ttra v√•r service!</p>

        <!-- Star Rating -->
        <div id="starRatingContainer" style="display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;">
          <button type="button" class="starBtn" data-rating="1" onclick="setFeedbackRating(1)"
            style="background: none; border: none; cursor: pointer; font-size: 36px; color: var(--muted); transition: all 0.2s;">‚òÜ</button>
          <button type="button" class="starBtn" data-rating="2" onclick="setFeedbackRating(2)"
            style="background: none; border: none; cursor: pointer; font-size: 36px; color: var(--muted); transition: all 0.2s;">‚òÜ</button>
          <button type="button" class="starBtn" data-rating="3" onclick="setFeedbackRating(3)"
            style="background: none; border: none; cursor: pointer; font-size: 36px; color: var(--muted); transition: all 0.2s;">‚òÜ</button>
          <button type="button" class="starBtn" data-rating="4" onclick="setFeedbackRating(4)"
            style="background: none; border: none; cursor: pointer; font-size: 36px; color: var(--muted); transition: all 0.2s;">‚òÜ</button>
          <button type="button" class="starBtn" data-rating="5" onclick="setFeedbackRating(5)"
            style="background: none; border: none; cursor: pointer; font-size: 36px; color: var(--muted); transition: all 0.2s;">‚òÜ</button>
        </div>

        <input type="hidden" id="feedbackRatingValue" value="0" />
        <input type="hidden" id="feedbackTargetType" value="ai" />
        <input type="hidden" id="feedbackTargetAgentId" value="" />

        <!-- Optional Comment -->
        <textarea id="feedbackComment" class="input" rows="3" placeholder="Ber√§tta mer (valfritt)..."
          style="width: 100%; margin-bottom: 20px; resize: none;"></textarea>

        <div style="display: flex; gap: 10px; justify-content: center;">
          <button id="skipFeedbackBtn" class="btn ghost" onclick="closeFeedbackModal()" type="button">Hoppa
            √∂ver</button>
          <button id="submitFeedbackBtn" class="btn primary" onclick="submitCustomerFeedback()" type="button">
            <i class="fa-solid fa-paper-plane"></i> Skicka
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: ADD DEAL (ADVANCED) -->
  <div id="crmAddDealModal" class="modal" style="display: none;">
    <div class="modalContent" style="max-width: 700px; padding:0; display:flex; flex-direction:column; height:80vh;">
      <div class="modalHeader" style="padding:20px; border-bottom:1px solid var(--border);">
        <h3><i class="fa-solid fa-briefcase"></i> Ny Aff√§rsm√∂jlighet</h3>
        <button class="btn ghost small" onclick="closeCrmModal('crmAddDealModal')"><i
            class="fa-solid fa-times"></i></button>
      </div>

      <div class="modalBody" style="flex:1; overflow-y:auto; padding:20px;">
        <div class="grid2 gap">
          <div class="col">
            <label>Aff√§rens namn *</label>
            <input id="dealName" class="input" placeholder="T.ex. Q3 Licenser + Support" />
          </div>
          <div class="col">
            <label>Kopplad Kund (F√∂retag) *</label>
            <input id="dealCompanyInput" class="input" list="dealCompanyList" placeholder="S√∂k f√∂retag..."
              oninput="filterCompanyList(this)" />
            <datalist id="dealCompanyList">
              <!-- Populated via JS -->
            </datalist>
          </div>
        </div>

        <div class="grid2 gap">
          <div class="col">
            <label>Aff√§rsv√§rde (SEK)</label>
            <div class="inputGroup">
              <input id="dealValue" type="number" class="input" placeholder="0" />
              <span class="inputSuffix">kr</span>
            </div>
          </div>
          <div class="col">
            <label>Sannolikhet (%)</label>
            <input id="dealProb" type="range" class="input" min="0" max="100" value="50"
              oninput="this.nextElementSibling.textContent = this.value + '%'" />
            <div style="text-align:right; font-size:12px; font-weight:bold; color:var(--primary);">50%</div>
          </div>
        </div>

        <div class="grid2 gap">
          <div class="col">
            <label>Pipeline Fas</label>
            <select id="dealStage" class="input">
              <option value="new">Nytt Lead</option>
              <option value="qualified">Kvalificerad</option>
              <option value="proposal">Offert Skickad</option>
              <option value="negotiation">F√∂rhandling</option>
              <option value="won">Vunnen (St√§ngd)</option>
              <option value="lost">F√∂rlorad</option>
            </select>
          </div>
          <div class="col">
            <label>F√∂rv√§ntat Avslut</label>
            <input id="dealCloseDate" type="date" class="input" />
          </div>
        </div>

        <div class="grid2 gap">
          <div class="col">
            <label>Aff√§rstyp</label>
            <select id="dealType" class="input">
              <option value="new">Nyf√∂rs√§ljning</option>
              <option value="upsell">Merk√∂p / Uppgradering</option>
              <option value="renewal">F√∂rnyelse</option>
            </select>
          </div>
          <div class="col">
            <label>Ansvarig S√§ljare</label>
            <select id="dealOwner" class="input">
              <option value="me">Jag</option>
              <option value="team">S√§ljteamet</option>
            </select>
          </div>
        </div>

        <label>Beskrivning / Produkter</label>
        <textarea id="dealDesc" class="input" style="height:80px; resize:none;"
          placeholder="Vad ing√•r i aff√§ren?"></textarea>

        <label>N√§sta Steg</label>
        <input id="dealNextStep" class="input" placeholder="T.ex. Skicka avtalsutkast..." />
      </div>

      <div class="modalFooter"
        style="padding:20px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:10px; background:var(--panel);">
        <button class="btn ghost" onclick="closeCrmModal('crmAddDealModal')">Avbryt</button>
        <button class="btn primary" onclick="saveNewDealAdvanced()">
          <i class="fa-solid fa-plus"></i> Skapa Aff√§r
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL: EDIT DEAL -->
  <div id="crmEditDealModal" class="modal" style="display: none;">
    <div class="modalContent" style="max-width: 700px; padding:0; display:flex; flex-direction:column; height:80vh;">
      <div class="modalHeader" style="padding:20px; border-bottom:1px solid var(--border);">
        <h3><i class="fa-solid fa-pen-to-square"></i> Redigera Aff√§r</h3>
        <button class="btn ghost small" onclick="closeCrmModal('crmEditDealModal')"><i
            class="fa-solid fa-times"></i></button>
      </div>
      <div class="modalBody" style="flex:1; overflow-y:auto; padding:20px;">
        <input type="hidden" id="editDealId" />
        <div class="grid2 gap">
          <div class="col">
            <label>Aff√§rens namn</label>
            <input id="editDealName" class="input" />
          </div>
          <div class="col">
            <label>F√∂retag</label>
            <input id="editDealCompany" class="input" disabled />
          </div>
        </div>
        <div class="grid2 gap">
          <div class="col">
            <label>V√§rde (SEK)</label>
            <input id="editDealValue" type="number" class="input" />
          </div>
          <div class="col">
            <label>Fas</label>
            <select id="editDealStage" class="input">
              <option value="new">Nytt Lead</option>
              <option value="qualified">Kvalificerad</option>
              <option value="proposal">Offert Skickad</option>
              <option value="negotiation">F√∂rhandling</option>
              <option value="won">Vunnen</option>
              <option value="lost">F√∂rlorad</option>
            </select>
          </div>
        </div>
        <label>Beskrivning</label>
        <textarea id="editDealDesc" class="input" style="height:80px; resize:none;"></textarea>
      </div>
      <div class="modalFooter"
        style="padding:20px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:10px;">
        <button class="btn ghost" onclick="closeCrmModal('crmEditDealModal')">Avbryt</button>
        <button class="btn primary" onclick="updateDeal()">Spara √§ndringar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: LOG ACTIVITY -->
  <div id="crmLogActivityModal" class="modal" style="display: none;">
    <div class="modalContent" style="max-width: 500px;">
      <div class="modalHeader">
        <h3><i class="fa-solid fa-list-check"></i> Logga Aktivitet</h3>
        <button class="btn ghost small" onclick="closeCrmModal('crmLogActivityModal')"><i
            class="fa-solid fa-times"></i></button>
      </div>
      <div class="modalBody">
        <label>Typ av aktivitet</label>
        <div class="row gap" style="margin-bottom:15px;">
          <button class="btn ghost small activityTypeBtn active" onclick="setActivityType('call', this)"><i
              class="fa-solid fa-phone"></i> Samtal</button>
          <button class="btn ghost small activityTypeBtn" onclick="setActivityType('meeting', this)"><i
              class="fa-solid fa-users"></i> M√∂te</button>
          <button class="btn ghost small activityTypeBtn" onclick="setActivityType('email', this)"><i
              class="fa-solid fa-envelope"></i> E-post</button>
          <button class="btn ghost small activityTypeBtn" onclick="setActivityType('task', this)"><i
              class="fa-solid fa-check"></i> Uppgift</button>
        </div>

        <label>Rubrik / √Ñmne</label>
        <input id="actSubject" class="input" placeholder="T.ex. Uppf√∂ljning av offert" />

        <label>Beskrivning</label>
        <textarea id="actDesc" class="input" style="height:80px;"
          placeholder="Anteckningar fr√•n m√∂tet/samtalet..."></textarea>

        <div class="row gap">
          <div class="col">
            <label>Datum</label>
            <input id="actDate" type="date" class="input" />
          </div>
          <div class="col">
            <label>Status</label>
            <select id="actStatus" class="input">
              <option value="done">Utf√∂rd</option>
              <option value="planned">Planerad</option>
            </select>
          </div>
        </div>

        <input type="hidden" id="actType" value="call" />
        <input type="hidden" id="actTargetId" /> <!-- Customer or Deal ID -->

        <button class="btn primary full" onclick="saveActivity()" style="margin-top:20px;">Spara</button>
      </div>
    </div>
  </div><!-- MODAL: ADD CUSTOMER (FULL ENTERPRISE) -->
  <div id="crmAddCustomerModal" class="modal" style="display: none;">
    <div class="modalContent" style="max-width: 850px; height: 85vh; display:flex; flex-direction:column; padding:0;">
      <div class="modalHeader" style="padding: 20px; border-bottom: 1px solid var(--border);">
        <h3><i class="fa-solid fa-building"></i> Ny F√∂retagskund</h3>
        <button class="btn ghost small" onclick="closeCrmModal('crmAddCustomerModal')"><i
            class="fa-solid fa-times"></i></button>
      </div>

      <!-- Tabs for Modal -->
      <div class="tabs" style="border-bottom:1px solid var(--border); padding:0 20px; background:var(--panel2);">
        <button class="tabBtn active" onclick="setModalTab('modalTabBasic', this)"
          style="padding: 15px 20px;">Grunduppgifter</button>
        <button class="tabBtn" onclick="setModalTab('modalTabContact', this)" style="padding: 15px 20px;">Kontakt &
          Adress</button>
        <button class="tabBtn" onclick="setModalTab('modalTabAi', this)" style="padding: 15px 20px;">AI &
          System</button>
      </div>

      <div class="modalBody" style="flex:1; overflow-y:auto; padding:20px;">

        <!-- TAB: BASIC -->
        <div id="modalTabBasic" class="modalTabContent">
          <div class="grid2 gap" style="margin-bottom:15px;">
            <div class="col">
              <label>F√∂retagsnamn *</label>
              <input id="custName" class="input" placeholder="T.ex. TechCorp AB" />
            </div>
            <div class="col">
              <label>Organisationsnummer</label>
              <input id="custOrgNr" class="input" placeholder="55XXXX-XXXX" />
            </div>
          </div>

          <div class="grid2 gap" style="margin-bottom:15px;">
            <div class="col">
              <label>Bransch</label>
              <select id="custIndustry" class="input">
                <option value="">V√§lj...</option>
                <option value="IT">IT & Teknik</option>
                <option value="Retail">Handel / E-handel</option>
                <option value="Construction">Bygg & Fastighet</option>
                <option value="Service">Tj√§nstef√∂retag</option>
                <option value="Finance">Bank & Finans</option>
                <option value="Public">Offentlig Sektor</option>
                <option value="Other">Annat</option>
              </select>
            </div>
            <div class="col">
              <label>Webbplats</label>
              <input id="custWeb" class="input" placeholder="https://..." />
            </div>
          </div>

          <div class="grid2 gap" style="margin-bottom:15px;">
            <div class="col">
              <label>Status</label>
              <select id="custStatus" class="input">
                <option value="prospect">Prospekt (Lead)</option>
                <option value="customer" selected>Aktiv Kund</option>
                <option value="inactive">Inaktiv</option>
                <option value="churn">F√∂re detta Kund</option>
              </select>
            </div>
            <div class="col">
              <label>Konto√§gare (S√§ljare)</label>
              <select id="custOwner" class="input">
                <option value="me">Jag (Nuvarande anv√§ndare)</option>
                <option value="unassigned">Ej tilldelad</option>
              </select>
            </div>
          </div>

          <div style="margin-top:10px;">
            <label>Interna Anteckningar</label>
            <textarea id="custNotes" class="input" style="height:80px; resize:none;"
              placeholder="Kort beskrivning av verksamheten, behov och historik..."></textarea>
          </div>
        </div>

        <!-- TAB: CONTACT & ADDRESS -->
        <div id="modalTabContact" class="modalTabContent" style="display:none;">
          <h4
            style="margin-bottom:15px; border-bottom:1px solid var(--border); padding-bottom:5px; color:var(--primary);">
            Prim√§r Kontaktperson</h4>
          <div class="grid2 gap" style="margin-bottom:15px;">
            <div class="col">
              <label>F√∂rnamn</label>
              <input id="custContactFirst" class="input" />
            </div>
            <div class="col">
              <label>Efternamn</label>
              <input id="custContactLast" class="input" />
            </div>
          </div>
          <div class="grid2 gap" style="margin-bottom:15px;">
            <div class="col">
              <label>E-post *</label>
              <input id="custEmail" type="email" class="input" placeholder="namn@foretag.se" />
            </div>
            <div class="col">
              <label>Telefon / Mobil</label>
              <input id="custPhone" class="input" placeholder="+46..." />
            </div>
          </div>
          <div class="col" style="margin-bottom:20px;">
            <label>Befattning / Roll</label>
            <input id="custRole" class="input" placeholder="T.ex. VD, IT-chef, Ink√∂pare" />
          </div>

          <h4
            style="margin:25px 0 15px; border-bottom:1px solid var(--border); padding-bottom:5px; color:var(--primary);">
            Adressuppgifter</h4>
          <div class="col" style="margin-bottom:15px;">
            <label>Gatuadress</label>
            <input id="custAddress" class="input" placeholder="Storgatan 1" />
          </div>
          <div class="grid2 gap" style="margin-bottom:15px;">
            <div class="col">
              <label>Postnummer</label>
              <input id="custZip" class="input" placeholder="123 45" />
            </div>
            <div class="col">
              <label>Ort</label>
              <input id="custCity" class="input" placeholder="Stockholm" />
            </div>
          </div>
          <div class="col">
            <label>Land</label>
            <select id="custCountry" class="input">
              <option value="SE" selected>Sverige</option>
              <option value="NO">Norge</option>
              <option value="DK">Danmark</option>
              <option value="FI">Finland</option>
              <option value="Other">Annat</option>
            </select>
          </div>
        </div>

        <!-- TAB: AI & SYSTEM -->
        <div id="modalTabAi" class="modalTabContent" style="display:none;">
          <div class="aiSetupBox"
            style="background:rgba(76, 125, 255, 0.05); border:1px dashed var(--primary); padding:20px; border-radius:8px; margin-bottom:20px;">
            <div class="row gap" style="align-items:flex-start; display:flex;">
              <input type="checkbox" id="custAiDeploy" checked
                style="width:20px; height:20px; margin-top:5px; accent-color:var(--primary);" />
              <div style="margin-left:10px;">
                <b style="color:var(--primary); font-size:16px;">Aktivera AI Kundtj√§nst (Auto-Deploy) ü§ñ</b>
                <p class="muted" style="margin-top:5px; line-height:1.5; font-size:13px;">
                  N√§r du sparar kunden konfigureras AI-agenten automatiskt med unik API-nyckel och grundl√§ggande
                  kunskap.
                </p>
              </div>
            </div>
          </div>

          <div class="grid2 gap">
            <div class="col">
              <label>AI-Modell</label>
              <select id="custAiModel" class="input">
                <option value="gpt-4o">GPT-4o (Rekommenderad)</option>
                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
              </select>
            </div>
            <div class="col">
              <label>Spr√•kst√∂d</label>
              <select id="custAiLang" class="input">
                <option value="sv">Svenska (Prim√§rt)</option>
                <option value="en">Engelska</option>
                <option value="multi">Flerspr√•kig (Auto-detect)</option>
              </select>
            </div>
          </div>
        </div>

      </div>

      <div class="modalFooter"
        style="padding:20px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:10px; background:var(--panel);">
        <button class="btn ghost" onclick="closeCrmModal('crmAddCustomerModal')">Avbryt</button>
        <button class="btn primary" onclick="saveNewCustomerExpanded()">
          <i class="fa-solid fa-check"></i> Spara Kund & Konfigurera
        </button>
      </div>
    </div>
  </div><!-- AI DEPLOYMENT OVERLAY (Fake Loader) -->
  <div id="aiDeployOverlay" class="modal"
    style="display:none; align-items:center; justify-content:center; background:var(--overlay); backdrop-filter: blur(4px);">
    <div style="text-align:center; color:var(--text); width:300px;">
      <i class="fa-solid fa-circle-notch fa-spin" style="font-size:48px; color:var(--primary); margin-bottom:20px;"></i>
      <h2 id="aiDeployText" style="margin-bottom:10px;">Konfigurerar AI-agent...</h2>
      <div id="aiDeploySub" class="muted" style="margin-bottom:15px;">Analyserar f√∂retagsdata</div>
      <div style="width:100%; height:4px; background:var(--glass-border); border-radius:2px; overflow:hidden;">
        <div id="aiDeployBar" style="width:0%; height:100%; background:var(--primary); transition: width 0.5s ease;">
        </div>
      </div>
    </div>
  </div>
  <script src="script.js?v=2026.12"></script>
  <script src="mobile_optimization.js?v=2026.12"></script>
  <script src="crm_enhancements.js?v=2026.12"></script>
  <script src="contact_logic.js?v=2026.12"></script>
</body>

</html>